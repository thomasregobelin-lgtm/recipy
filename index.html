<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Recipy">
<meta name="theme-color" content="#FF3E7F">
<meta name="description" content="Recipy â€” Planificateur de repas intelligent">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
<title>Recipy â€” Planificateur</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700,900&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root{
  --pink:#FF3E7F; --pink-soft:#FFF0F5; --pink-mid:#FFB3CE;
  --dark:#1A1A2E; --gray:#6B7280; --gray-light:#E5E7EB;
  --light:#F5F5F7; --white:#fff;
  --green:#10B981; --amber:#F59E0B; --blue:#3B82F6;
  --radius-card:20px; --radius-pill:50px;
  --shadow-card:0 4px 20px rgba(0,0,0,.08);
  --shadow-float:0 16px 48px rgba(0,0,0,.18);
  --font-display:Georgia,serif;
  --font-body:"DM Sans",sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{font-family:'DM Sans',sans-serif;background:var(--light);margin:0;padding:0;overflow:hidden;}
html{height:100%;overflow:hidden;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APP SHELL â€” full viewport, no phone frame
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.phone{
  width:100%;
  height:100vh;
  height:100dvh;
  background:var(--light);
  position:relative;
  overflow:hidden;
}
.screen{
  width:100%;
  height:100%;
  position:absolute;
  inset:0;
  display:none;
  flex-direction:column;
  opacity:0;
  transition:opacity .28s ease;
}
.screen.active{display:flex;opacity:1;}
.status-bar{display:none;}
@media(min-width:481px){
  .status-bar{display:flex;justify-content:space-between;align-items:center;padding:14px 28px 0;font-size:13px;font-weight:600;color:var(--dark);flex-shrink:0;}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPLASH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#splash{background:linear-gradient(160deg,#1A1A2E 0%,#16213E 55%,#0F3460 100%);justify-content:center;align-items:center;}
.splash-logo{font-family:'Playfair Display',Georgia,serif;font-size:52px;font-weight:900;color:#fff;letter-spacing:-1px;}
.splash-sub{color:rgba(255,255,255,.45);font-size:14px;margin-top:6px;}
.splash-emoji{font-size:78px;margin-bottom:18px;}
.splash-btn{margin-top:56px;background:var(--pink);color:#fff;border:none;padding:18px 60px;border-radius:var(--radius-pill);font-size:16px;font-weight:600;font-family:inherit;cursor:pointer;box-shadow:0 10px 32px rgba(255,62,127,.45);transition:transform .15s;}
.splash-btn:active{transform:scale(.96);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ONBOARDING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page-body{padding:20px 24px;flex:1;overflow-y:auto;}
.page-title{font-family:'Playfair Display',Georgia,serif;font-size:26px;font-weight:700;color:var(--dark);margin-bottom:6px;}
.page-sub{color:var(--gray);font-size:14px;margin-bottom:20px;}
.dots{display:flex;gap:8px;margin-bottom:20px;}
.dot{width:8px;height:8px;border-radius:50%;background:var(--gray-light);transition:all .3s;}
.dot.active{background:var(--pink);width:24px;border-radius:4px;}
.input-group{margin:12px 0;}
.input-group label{font-size:11px;font-weight:700;color:var(--gray);display:block;margin-bottom:5px;letter-spacing:.6px;text-transform:uppercase;}
.input-group input{width:100%;padding:14px 18px;border:2px solid var(--gray-light);border-radius:16px;font-family:inherit;font-size:15px;outline:none;transition:border-color .2s;color:var(--dark);}
.input-group input:focus{border-color:var(--pink);}
.btn-p{width:100%;padding:16px;background:var(--pink);color:#fff;border:none;border-radius:16px;font-family:inherit;font-size:16px;font-weight:600;cursor:pointer;margin-top:12px;box-shadow:0 8px 20px rgba(255,62,127,.3);transition:transform .15s;}
.btn-p:active{transform:scale(.98);}
.btn-s{width:100%;padding:15px;background:transparent;color:var(--dark);border:2px solid var(--gray-light);border-radius:16px;font-family:inherit;font-size:15px;font-weight:600;cursor:pointer;margin-top:8px;}
.or-div{text-align:center;color:var(--gray);font-size:13px;margin:14px 0;position:relative;}
.or-div::before,.or-div::after{content:"";position:absolute;top:50%;width:38%;height:1px;background:var(--gray-light);}
.or-div::before{left:0;}.or-div::after{right:0;}
.allergy-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin:14px 0;}
.allergy-chip{padding:18px 12px;border-radius:18px;border:2px solid var(--gray-light);display:flex;flex-direction:column;align-items:center;gap:6px;cursor:pointer;transition:all .2s;}
.allergy-chip .ci{font-size:28px;}.allergy-chip .cl{font-size:12px;font-weight:500;color:var(--dark);}
.allergy-chip.selected{border-color:var(--pink);background:var(--pink-soft);}
.diet-opt{display:flex;align-items:center;gap:14px;padding:16px;border-radius:16px;border:2px solid var(--gray-light);margin:8px 0;cursor:pointer;transition:all .2s;}
.diet-ic{font-size:32px;}.diet-inf h4{font-size:14px;font-weight:600;color:var(--dark);}.diet-inf p{font-size:11px;color:var(--gray);margin-top:2px;}
.diet-chk{margin-left:auto;width:22px;height:22px;border-radius:50%;border:2px solid var(--gray-light);display:flex;align-items:center;justify-content:center;font-size:11px;transition:all .2s;}
.diet-opt.selected{border-color:var(--pink);background:var(--pink-soft);}
.diet-opt.selected .diet-chk{background:var(--pink);border-color:var(--pink);color:#fff;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN SWIPE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#main{background:var(--light);}
.main-hdr{display:flex;justify-content:space-between;align-items:center;padding:18px 24px 10px;flex-shrink:0;}
.main-title{font-family:'Playfair Display',Georgia,serif;font-size:26px;font-weight:900;color:var(--dark);}
.icon-btn{width:42px;height:42px;border-radius:14px;background:var(--white);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:19px;box-shadow:var(--shadow-card);transition:transform .15s;}
.icon-btn:active{transform:scale(.9);}
.filt-bar{display:flex;gap:7px;padding:0 24px 14px;overflow-x:auto;flex-shrink:0;}
.filt-bar::-webkit-scrollbar{display:none;}
.filt-pill{padding:7px 16px;border-radius:var(--radius-pill);border:2px solid var(--gray-light);background:var(--white);font-size:12px;font-weight:600;color:var(--gray);cursor:pointer;white-space:nowrap;transition:all .2s;}
.filt-pill.active{background:var(--pink);border-color:var(--pink);color:#fff;}
.card-area{flex:1;display:flex;align-items:center;justify-content:center;padding:0 18px;}
.recipe-card{width:100%;max-width:316px;background:var(--white);border-radius:24px;overflow:hidden;box-shadow:0 20px 64px rgba(0,0,0,.13);cursor:grab;user-select:none;position:relative;}
.recipe-card.dragging{cursor:grabbing;}
.card-img{width:100%;height:210px;display:flex;align-items:center;justify-content:center;font-size:80px;position:relative;}
.card-ov{position:absolute;inset:0;background:linear-gradient(to bottom,transparent 50%,rgba(0,0,0,.14));}
.swipe-badge{position:absolute;top:18px;border-radius:12px;padding:7px 18px;font-size:16px;font-weight:800;opacity:0;pointer-events:none;z-index:10;}
.swipe-badge.left{left:18px;background:#FF4757;color:#fff;transform:rotate(-15deg);}
.swipe-badge.right{right:18px;background:#2ED573;color:#fff;transform:rotate(15deg);}
.card-body{padding:14px 18px 18px;}
.card-tags{display:flex;gap:5px;margin-bottom:7px;}
.card-tag{padding:3px 10px;border-radius:var(--radius-pill);background:var(--pink-soft);color:var(--pink);font-size:10px;font-weight:700;letter-spacing:.3px;}
.card-title{font-family:'Playfair Display',Georgia,serif;font-size:19px;font-weight:700;color:var(--dark);}
.card-desc{color:var(--gray);font-size:12px;margin-top:4px;line-height:1.5;}
.card-meta{display:flex;gap:12px;margin-top:10px;}
.card-meta-item{font-size:11px;color:var(--gray);font-weight:500;}
.swipe-actions{display:flex;justify-content:center;align-items:center;gap:18px;padding:8px 24px 12px;flex-shrink:0;}
.act-btn{border-radius:50%;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .2s;}
.act-btn:active{transform:scale(.86)!important;}
.act-pass{width:54px;height:54px;font-size:22px;background:var(--white);color:#555;box-shadow:var(--shadow-card);}
.act-save{width:54px;height:54px;font-size:22px;background:var(--pink);color:#fff;box-shadow:0 8px 24px rgba(255,62,127,.42);}
.act-info{width:40px;height:40px;font-size:17px;background:var(--white);color:var(--pink);box-shadow:var(--shadow-card);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOTTOM NAV (4 tabs)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bottom-nav{display:flex;justify-content:space-around;align-items:stretch;padding:0 0 max(22px,env(safe-area-inset-bottom));background:var(--white);border-top:1px solid rgba(0,0,0,.05);flex-shrink:0;position:relative;}
.nav-indicator{position:absolute;top:0;height:3px;border-radius:0 0 4px 4px;background:var(--pink);width:var(--ind-w,25%);left:var(--ind-l,0%);transition:left .32s cubic-bezier(.4,0,.2,1),width .32s cubic-bezier(.4,0,.2,1);pointer-events:none;}
.nav-btn{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;padding:10px 0 2px;border:none;background:transparent;cursor:pointer;position:relative;outline:none;}
.nav-btn::after{content:"";position:absolute;inset:0;background:rgba(255,62,127,.09);opacity:0;transform:scale(.5);border-radius:14px;transition:opacity .22s,transform .22s;pointer-events:none;}
.nav-btn.tap::after{opacity:1;transform:scale(1);}
.nav-icon{font-size:21px;display:flex;align-items:center;justify-content:center;position:relative;transition:transform .28s cubic-bezier(.34,1.56,.64,1);}
.nav-label{font-size:9px;font-weight:700;letter-spacing:.4px;color:var(--gray);transition:color .22s,opacity .2s,transform .22s;opacity:0;transform:translateY(4px);white-space:nowrap;text-transform:uppercase;}
.nav-btn.active .nav-icon{transform:scale(1.2) translateY(-2px);}
.nav-btn.active .nav-label{color:var(--pink);opacity:1;transform:translateY(0);}
.nav-badge{position:absolute;top:-5px;right:-8px;min-width:16px;height:16px;border-radius:9px;background:var(--pink);color:#fff;font-size:9px;font-weight:700;display:flex;align-items:center;justify-content:center;padding:0 3px;transform:scale(0);transition:transform .28s cubic-bezier(.34,1.56,.64,1);border:2px solid var(--white);pointer-events:none;}
.nav-badge.show{transform:scale(1);}
@keyframes badgePop{0%{transform:scale(1.7);}100%{transform:scale(1);}}
.nav-badge.pop{animation:badgePop .28s cubic-bezier(.34,1.56,.64,1) forwards;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DETAIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#detail{background:var(--white);}
.det-img{height:250px;display:flex;align-items:center;justify-content:center;font-size:100px;position:relative;flex-shrink:0;}
.det-back,.det-fav{position:absolute;top:56px;width:42px;height:42px;border-radius:50%;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:19px;transition:transform .18s;}
.det-back{left:18px;background:rgba(255,255,255,.92);}
.det-fav{right:18px;background:var(--pink);color:#fff;}
.det-fav:active,.det-back:active{transform:scale(.84);}
.det-body{flex:1;overflow-y:auto;padding:18px 22px 20px;}
.det-title{font-family:'Playfair Display',Georgia,serif;font-size:24px;font-weight:700;color:var(--dark);}
.det-desc{color:var(--gray);margin-top:6px;line-height:1.6;font-size:13px;}
.portion-ctrl{display:flex;align-items:center;gap:14px;background:var(--light);border-radius:18px;padding:13px 16px;margin-top:16px;}
.portion-lbl{font-weight:600;font-size:14px;color:var(--dark);flex:1;}
.portion-btns{display:flex;align-items:center;gap:12px;}
.portion-btn{width:32px;height:32px;border-radius:50%;background:var(--pink);color:#fff;border:none;cursor:pointer;font-size:17px;display:flex;align-items:center;justify-content:center;transition:transform .14s;}
.portion-btn:active{transform:scale(.86);}
.portion-num{font-size:19px;font-weight:700;color:var(--dark);min-width:22px;text-align:center;}
/* Add to planning button */
.btn-planning{width:100%;padding:14px;background:linear-gradient(135deg,var(--dark),#2d2d4e);color:#fff;border:none;border-radius:14px;font-family:inherit;font-size:14px;font-weight:600;cursor:pointer;margin-top:14px;display:flex;align-items:center;justify-content:center;gap:8px;transition:transform .15s;}
.btn-planning:active{transform:scale(.98);}
.sec-title{font-family:'Playfair Display',Georgia,serif;font-size:18px;font-weight:700;color:var(--dark);margin:18px 0 10px;}
.ing-list{display:flex;flex-direction:column;gap:8px;}
.ing-item{display:flex;justify-content:space-between;align-items:center;padding:11px 14px;background:var(--light);border-radius:12px;}
.ing-name{font-size:13px;font-weight:500;color:var(--dark);}
.ing-qty{font-size:12px;color:var(--pink);font-weight:600;}
.steps{display:flex;flex-direction:column;gap:12px;}
.step{display:flex;gap:12px;}
.step-n{width:28px;height:28px;border-radius:50%;background:var(--pink);color:#fff;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;flex-shrink:0;}
.step-t{font-size:13px;color:var(--gray);line-height:1.6;padding-top:3px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SAVED / MES RECETTES â€” liste verticale iOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#saved{background:#F2F2F7;}
.saved-topbar{display:flex;justify-content:space-between;align-items:center;padding:14px 20px 6px;flex-shrink:0;}
.saved-topbar .main-title{font-family:'Playfair Display',Georgia,serif;font-size:24px;font-weight:900;color:var(--dark);}
.count-label{font-size:11px;color:var(--gray);margin-top:2px;}
/* sel-toolbar kept for JS compat but unused visually */
.sel-toolbar,.sel-info,.sel-actions{display:none!important;}
/* â”€â”€ Animations â”€â”€ */
@keyframes cardIn{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}
@keyframes cardExit{to{opacity:0;transform:translateX(60px);height:0;padding:0;margin:0;}}
/* â”€â”€ Section wrapper (groups rows into a card) â”€â”€ */
.saved-section{margin:0 16px 14px;border-radius:16px;overflow:hidden;box-shadow:0 1px 6px rgba(0,0,0,.07);background:var(--white);}
/* â”€â”€ Row â”€â”€ */
.rc-row{background:var(--white);display:flex;flex-direction:column;border-bottom:1px solid #EBEBF0;animation:cardIn .26s ease both;transition:background .1s;}
.rc-row:last-child{border-bottom:none;}
.rc-row.card-exit{animation:cardExit .22s ease forwards;}
/* â”€â”€ Row main line â”€â”€ */
.rc-main{display:flex;align-items:center;gap:13px;padding:11px 14px;cursor:pointer;}
.rc-main:active{background:#F9F9FB;}
/* Photo ronde */
.rc-photo{width:54px;height:54px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:27px;overflow:hidden;}
/* Infos centre */
.rc-info{flex:1;min-width:0;}
.rc-title{font-size:14px;font-weight:700;color:var(--dark);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.rc-meta{font-size:11px;color:var(--gray);margin-top:2px;}
/* Portions */
.rc-portions{display:flex;align-items:center;gap:4px;background:#F2F2F7;border-radius:20px;padding:4px 10px;flex-shrink:0;}
.rc-portions span{font-size:12px;font-weight:600;color:var(--dark);}
/* Chevron */
.rc-chevron{font-size:14px;color:#C7C7CC;margin-left:6px;flex-shrink:0;transition:transform .22s cubic-bezier(.4,0,.2,1);}
.rc-row.expanded .rc-chevron{transform:rotate(90deg);color:var(--pink);}
/* â”€â”€ Action bar (collapsed by default) â”€â”€ */
.rc-actions{display:flex;gap:0;border-top:1px solid #F0F0F5;overflow:hidden;max-height:0;opacity:0;transition:max-height .26s cubic-bezier(.4,0,.2,1), opacity .2s ease;}
.rc-row.expanded .rc-actions{max-height:52px;opacity:1;}
.rc-action-btn{flex:1;padding:13px 0;border:none;background:transparent;font-family:'DM Sans',sans-serif;font-size:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:5px;transition:background .12s;border-right:1px solid #F0F0F5;}
.rc-action-btn:last-child{border-right:none;}
.rc-action-btn:active{background:#F5F5F8;}
.rc-action-btn.del{color:#FF3B30;}
.rc-action-btn.detail{color:var(--dark);}
.rc-action-btn.plan{color:var(--pink);}
/* â”€â”€ List scroll container â”€â”€ */
.saved-list{flex:1;overflow-y:auto;padding:4px 0 16px;}
/* â”€â”€ Empty state â”€â”€ */
.empty-state{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;text-align:center;}
.empty-state .ei{font-size:56px;margin-bottom:16px;opacity:.38;}
.empty-state h3{font-family:'Playfair Display',Georgia,serif;font-size:20px;color:var(--dark);margin-bottom:6px;}
.empty-state p{font-size:13px;color:var(--gray);line-height:1.6;}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CALENDRIER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#calendar{background:var(--light);}
.cal-hdr{display:flex;justify-content:space-between;align-items:center;padding:14px 22px 8px;flex-shrink:0;}
.cal-hdr .main-title{font-family:'Playfair Display',Georgia,serif;font-size:24px;font-weight:900;color:var(--dark);}
/* Week strip â€” horizontal row of 7 days */
.week-strip{display:flex;flex-direction:row;padding:0 12px 10px;flex-shrink:0;gap:0;}
.day-col{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;}
.day-label{font-size:9px;font-weight:700;color:var(--gray);letter-spacing:.5px;text-transform:uppercase;}
.day-num{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;color:var(--dark);}
.day-num.today{background:var(--pink);color:#fff;}
/* Cal body */
.cal-body{flex:1;overflow-y:auto;padding:0 12px 16px;}
.cal-day-section{margin-bottom:10px;}
.cal-day-title{font-size:11px;font-weight:700;color:var(--gray);letter-spacing:.5px;text-transform:uppercase;margin-bottom:5px;padding:0 2px;}
/* Filled meal slot */
.meal-slot{background:#fff;border-radius:14px;padding:10px 12px;margin-bottom:6px;display:flex;align-items:center;gap:10px;box-shadow:0 1px 6px rgba(0,0,0,.06);cursor:grab;}
.meal-slot[draggable="true"]:active{cursor:grabbing;}
.meal-slot.drag-over{outline:2px dashed var(--pink);background:var(--pink-soft);}
.meal-emoji{font-size:28px;flex-shrink:0;}
.meal-info{flex:1;min-width:0;}
.meal-title{font-size:13px;font-weight:700;color:var(--dark);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.meal-meta{font-size:10px;color:var(--gray);margin-top:2px;}
.meal-time-badge{display:inline-block;padding:2px 7px;border-radius:6px;font-size:9px;font-weight:700;letter-spacing:.3px;margin-bottom:2px;}
.meal-time-badge.midi{background:#FEF3C7;color:#D97706;}
.meal-time-badge.soir{background:#EDE9FE;color:#7C3AED;}
.meal-remove{width:26px;height:26px;border-radius:50%;background:var(--light);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:13px;color:var(--gray);flex-shrink:0;transition:all .15s;}
.meal-remove:hover{background:#FEE2E2;color:#EF4444;}
/* Empty slot */
.meal-slot-empty{background:rgba(255,255,255,.6);border:1.5px dashed var(--gray-light);border-radius:14px;padding:10px 14px;margin-bottom:6px;display:flex;align-items:center;gap:8px;cursor:pointer;transition:all .18s;}
.meal-slot-empty:hover,.meal-slot-empty:active{border-color:var(--pink);background:var(--pink-soft);}
.meal-slot-empty span{font-size:12px;color:var(--gray);}
/* Calendar empty hint */
.cal-empty-hint{text-align:center;padding:24px 20px;color:var(--gray);font-size:13px;line-height:1.7;}

#prefs{background:var(--light);}
.prefs-body{flex:1;overflow-y:auto;padding:14px;}
.prefs-sec{background:var(--white);border-radius:18px;overflow:hidden;margin-bottom:14px;}
.prefs-row{display:flex;align-items:center;padding:14px 16px;border-bottom:1px solid #F3F4F6;cursor:pointer;}
.prefs-row:last-child{border-bottom:none;}
.prefs-ic{font-size:20px;margin-right:12px;}
.prefs-lbl{font-size:14px;font-weight:500;color:var(--dark);flex:1;}
.prefs-arr{color:var(--gray);}
.prof-hdr{display:flex;flex-direction:column;align-items:center;padding:18px;margin-bottom:8px;}
.prof-av{width:76px;height:76px;border-radius:50%;background:linear-gradient(135deg,var(--pink),#FF6B9D);display:flex;align-items:center;justify-content:center;font-size:34px;margin-bottom:10px;}
.prof-name{font-family:'Playfair Display',Georgia,serif;font-size:20px;font-weight:700;color:var(--dark);}
.prof-sub{color:var(--gray);font-size:12px;margin-top:3px;}
.toggle{width:46px;height:24px;border-radius:12px;background:var(--gray-light);position:relative;cursor:pointer;transition:background .28s;flex-shrink:0;}
.toggle.on{background:var(--pink);}
.toggle::after{content:"";position:absolute;width:18px;height:18px;border-radius:50%;background:#fff;top:3px;left:3px;transition:transform .28s;box-shadow:0 2px 5px rgba(0,0,0,.2);}
.toggle.on::after{transform:translateX(22px);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay{position:absolute;inset:0;background:rgba(0,0,0,.42);z-index:99;opacity:0;pointer-events:none;transition:opacity .28s;}
.overlay.show{opacity:1;pointer-events:all;}
.modal{position:absolute;bottom:0;left:0;right:0;transform:translateY(100%);width:100%;background:var(--white);border-radius:28px 28px 0 0;padding:18px 22px 36px;transition:transform .36s cubic-bezier(.4,0,.2,1);z-index:100;max-height:82%;overflow-y:auto;}
.modal.open{transform:translateY(0);}
.modal.open{transform:translateY(0);}
.modal-handle{width:38px;height:4px;background:var(--gray-light);border-radius:2px;margin:0 auto 16px;}
.modal-title{font-family:'Playfair Display',Georgia,serif;font-size:20px;font-weight:700;color:var(--dark);margin-bottom:14px;}
/* Planning picker */
.plan-day-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;margin-bottom:14px;}
.plan-day-btn{padding:8px 0;border-radius:10px;border:2px solid var(--gray-light);background:transparent;font-family:inherit;font-size:10px;font-weight:700;cursor:pointer;text-align:center;transition:all .18s;}
.plan-day-btn.selected{background:var(--dark);border-color:var(--dark);color:#fff;}
.plan-time-row{display:flex;gap:8px;margin-bottom:14px;}
.plan-time-btn{flex:1;padding:11px;border-radius:12px;border:2px solid var(--gray-light);background:transparent;font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;transition:all .18s;}
.plan-time-btn.selected{border-color:var(--pink);background:var(--pink-soft);color:var(--pink);}
/* Filter modal */
.filt-sec-title{font-size:11px;font-weight:700;color:var(--gray);margin:12px 0 8px;letter-spacing:.5px;text-transform:uppercase;}
.filt-chips{display:flex;flex-wrap:wrap;gap:7px;}
.filt-chip{padding:7px 14px;border-radius:var(--radius-pill);border:2px solid var(--gray-light);font-size:12px;font-weight:600;cursor:pointer;transition:all .18s;}
.filt-chip.selected{border-color:var(--pink);background:var(--pink-soft);color:var(--pink);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast{position:fixed;bottom:calc(86px + env(safe-area-inset-bottom));left:50%;transform:translateX(-50%) translateY(18px);background:var(--dark);color:#fff;padding:10px 20px;border-radius:var(--radius-pill);font-size:13px;font-weight:500;white-space:nowrap;opacity:0;transition:all .28s cubic-bezier(.34,1.56,.64,1);z-index:200;pointer-events:none;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MICRO ANIMATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes heartBurst{0%{transform:scale(1);}30%{transform:scale(1.52);}65%{transform:scale(.92);}100%{transform:scale(1);}}
.heart-burst{animation:heartBurst .38s cubic-bezier(.34,1.56,.64,1) forwards;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LISTE DE COURSES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#shopping{background:#F2F2F7;}
.shop-hdr{padding:14px 20px 4px;flex-shrink:0;}
.shop-action-btn{padding:10px 0;border:none;border-radius:12px;font-family:'DM Sans',sans-serif;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:5px;transition:transform .13s;}
.shop-action-btn:active{transform:scale(.95);}
.shop-action-btn.export{background:var(--pink);color:#fff;box-shadow:0 4px 16px rgba(255,62,127,.3);}
.shop-action-btn.uncheck,.shop-action-btn.reset{background:var(--white);color:var(--dark);box-shadow:0 1px 4px rgba(0,0,0,.08);}
.shop-body{flex:1;overflow-y:auto;padding:0 14px 14px;}
.shop-category{margin-bottom:16px;}
.shop-cat-title{font-size:10px;font-weight:700;color:var(--gray);letter-spacing:.7px;text-transform:uppercase;margin-bottom:6px;padding:0 2px;}
.shop-card{background:var(--white);border-radius:14px;overflow:hidden;box-shadow:0 1px 6px rgba(0,0,0,.06);}
.shop-item{display:flex;align-items:center;gap:12px;padding:12px 14px;border-bottom:1px solid #F0F0F5;cursor:pointer;transition:opacity .15s;}
.shop-item:last-child{border-bottom:none;}
.shop-item.checked{opacity:.45;}
.shop-item.checked .shop-item-name{text-decoration:line-through;color:#9CA3AF;}
.shop-cb{width:22px;height:22px;border-radius:7px;border:2px solid #D1D5DB;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:13px;color:#fff;transition:all .18s;}
.shop-item.checked .shop-cb{background:#10B981;border-color:#10B981;}
.shop-item-name{flex:1;font-size:13px;font-weight:500;color:var(--dark);}
.shop-item-qty{font-size:12px;font-weight:700;color:var(--pink);flex-shrink:0;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CREATE RECIPE SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#create{background:#F2F2F7;}
.create-hdr{display:flex;align-items:center;gap:10px;padding:14px 18px 8px;flex-shrink:0;}
.create-hdr .main-title{font-family:'Playfair Display',Georgia,serif;font-size:22px;font-weight:900;color:#1A1A2E;flex:1;}
.create-hdr .btn-create-save{padding:8px 16px;background:#FF3E7F;color:#fff;border:none;border-radius:20px;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:transform .15s,opacity .15s;}
.create-hdr .btn-create-save:active{transform:scale(.94);}
.create-body{flex:1;overflow-y:auto;padding:0 16px 24px;}

/* Form sections */
.cf-section{background:#fff;border-radius:14px;overflow:hidden;margin-bottom:14px;box-shadow:0 1px 5px rgba(0,0,0,.06);}
.cf-section-title{font-size:10px;font-weight:700;color:#6B7280;letter-spacing:.7px;text-transform:uppercase;padding:10px 14px 2px;}
.cf-row{display:flex;align-items:center;padding:10px 14px;border-bottom:1px solid #F0F0F5;}
.cf-row:last-child{border-bottom:none;}
.cf-label{font-size:13px;font-weight:600;color:#1A1A2E;min-width:90px;flex-shrink:0;}
.cf-input{flex:1;border:none;outline:none;font-family:'DM Sans',sans-serif;font-size:13px;color:#1A1A2E;background:transparent;text-align:right;}
.cf-input::placeholder{color:#C7C7CC;}
.cf-textarea{width:100%;border:none;outline:none;font-family:'DM Sans',sans-serif;font-size:13px;color:#1A1A2E;background:transparent;resize:none;line-height:1.6;padding:10px 14px;box-sizing:border-box;min-height:90px;}
.cf-textarea::placeholder{color:#C7C7CC;}

/* Photo upload */
.cf-photo-zone{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;cursor:pointer;gap:8px;background:#FAFAFA;border:2px dashed #E5E7EB;border-radius:14px;margin-bottom:14px;transition:border-color .18s,background .18s;}
.cf-photo-zone:hover{border-color:#FF3E7F;background:#FFF5F8;}
.cf-photo-zone.has-photo{border-style:solid;border-color:#FF3E7F;padding:0;overflow:hidden;}
.cf-photo-zone img{width:100%;max-height:180px;object-fit:cover;border-radius:12px;}
.cf-photo-icon{font-size:32px;opacity:.4;}
.cf-photo-label{font-size:12px;color:#6B7280;font-weight:500;}

/* Tags */
.cf-tags-wrap{display:flex;flex-wrap:wrap;gap:7px;padding:10px 14px;}
.cf-tag{padding:5px 12px;border-radius:20px;font-size:11px;font-weight:700;cursor:pointer;border:2px solid #E5E7EB;background:transparent;color:#6B7280;transition:all .15s;font-family:'DM Sans',sans-serif;}
.cf-tag.selected{background:#FF3E7F;border-color:#FF3E7F;color:#fff;}
.cf-tag-input-row{display:flex;align-items:center;gap:8px;padding:6px 14px 12px;}
.cf-tag-input{flex:1;border:none;border-bottom:2px solid #E5E7EB;outline:none;font-family:'DM Sans',sans-serif;font-size:12px;color:#1A1A2E;background:transparent;padding:4px 0;}
.cf-tag-add{width:28px;height:28px;border-radius:50%;background:#FF3E7F;color:#fff;border:none;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;}

/* Ingredients list */
.cf-ing-list{padding:4px 14px 8px;}
.cf-ing-row{display:flex;align-items:center;gap:8px;padding:5px 0;border-bottom:1px solid #F5F5F7;}
.cf-ing-row:last-child{border-bottom:none;}
.cf-ing-name{flex:1;border:none;outline:none;font-family:'DM Sans',sans-serif;font-size:13px;color:#1A1A2E;background:transparent;}
.cf-ing-name::placeholder{color:#C7C7CC;}
.cf-ing-qty{width:70px;border:none;outline:none;font-family:'DM Sans',sans-serif;font-size:12px;color:#6B7280;background:transparent;text-align:right;}
.cf-ing-qty::placeholder{color:#C7C7CC;}
.cf-ing-del{width:22px;height:22px;border-radius:50%;background:#FEE2E2;border:none;color:#EF4444;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;line-height:1;}
.cf-add-row{display:flex;align-items:center;gap:8px;padding:8px 14px;cursor:pointer;color:#FF3E7F;font-size:12px;font-weight:700;}

/* Gradient picker */
.cf-grad-wrap{display:flex;gap:8px;padding:10px 14px;overflow-x:auto;}
.cf-grad-swatch{width:36px;height:36px;border-radius:50%;cursor:pointer;flex-shrink:0;border:3px solid transparent;transition:transform .15s,border-color .15s;}
.cf-grad-swatch.selected{border-color:#1A1A2E;transform:scale(1.15);}

/* Saved custom recipes list */
.create-list-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;text-align:center;gap:10px;}
.create-list-empty .ei{font-size:48px;opacity:.3;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CREATE RECIPE SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#create{background:#F2F2F7;}
.cr-hdr{display:flex;align-items:center;padding:14px 18px 6px;flex-shrink:0;gap:10px;}
.cr-title{font-family:'Playfair Display',Georgia,serif;font-size:22px;font-weight:900;color:#1A1A2E;flex:1;}
.cr-btn-new{padding:8px 16px;background:#FF3E7F;color:#fff;border:none;border-radius:20px;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;box-shadow:0 4px 14px rgba(255,62,127,.32);transition:transform .15s;}
.cr-btn-new:active{transform:scale(.94);}
.cr-tabs{display:flex;gap:0;padding:0 18px 10px;flex-shrink:0;}
.cr-tab{flex:1;padding:7px 0;text-align:center;font-size:12px;font-weight:700;color:#6B7280;border-bottom:2px solid transparent;cursor:pointer;transition:all .18s;}
.cr-tab.active{color:#FF3E7F;border-color:#FF3E7F;}
.cr-body{flex:1;overflow-y:auto;padding:0 14px 20px;}

/* Form card sections */
.cf-card{background:#fff;border-radius:14px;overflow:hidden;margin-bottom:12px;box-shadow:0 1px 5px rgba(0,0,0,.05);}
.cf-card-title{font-size:9px;font-weight:700;color:#9CA3AF;letter-spacing:.8px;text-transform:uppercase;padding:10px 14px 0;}
.cf-row{display:flex;align-items:center;min-height:44px;padding:0 14px;border-bottom:1px solid #F5F5F7;}
.cf-row:last-child{border-bottom:none;}
.cf-lbl{font-size:13px;font-weight:600;color:#1A1A2E;min-width:110px;flex-shrink:0;}
.cf-inp{flex:1;border:none;outline:none;font-family:'DM Sans',sans-serif;font-size:13px;color:#1A1A2E;background:transparent;text-align:right;padding:10px 0;}
.cf-inp::placeholder{color:#C7C7CC;}

/* Photo zone */
.cf-photo{display:flex;align-items:center;justify-content:center;min-height:130px;background:#FAFAFA;border:2px dashed #E5E7EB;border-radius:14px;cursor:pointer;flex-direction:column;gap:6px;margin-bottom:12px;transition:border-color .2s,background .2s;overflow:hidden;position:relative;}
.cf-photo:hover{border-color:#FF3E7F;background:#FFF5F8;}
.cf-photo.filled{border-style:solid;border-color:#FF3E7F;padding:0;}
.cf-photo img{width:100%;height:130px;object-fit:cover;display:block;}
.cf-photo-overlay{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(transparent,rgba(0,0,0,.4));padding:8px;display:flex;justify-content:flex-end;}
.cf-photo-change{background:rgba(255,255,255,.9);border:none;border-radius:10px;padding:4px 10px;font-size:11px;font-weight:600;cursor:pointer;color:#1A1A2E;}
.cf-photo-icon{font-size:28px;opacity:.3;}
.cf-photo-lbl{font-size:12px;color:#9CA3AF;font-weight:500;}

/* Emoji gradient picker */
.cf-emoji-row{display:flex;gap:10px;padding:10px 14px;align-items:center;flex-wrap:wrap;}
.cf-emoji-btn{font-size:24px;width:40px;height:40px;border-radius:10px;border:2px solid transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;background:#F5F5F7;transition:all .15s;}
.cf-emoji-btn.sel{border-color:#FF3E7F;background:#FFF0F5;transform:scale(1.12);}
.cf-grad-row{display:flex;gap:8px;padding:8px 14px 12px;overflow-x:auto;}
.cf-swatch{width:34px;height:34px;border-radius:50%;cursor:pointer;flex-shrink:0;border:3px solid transparent;transition:all .18s;}
.cf-swatch.sel{border-color:#1A1A2E;transform:scale(1.2);}

/* Tags */
.cf-tags-wrap{display:flex;flex-wrap:wrap;gap:7px;padding:10px 14px 6px;}
.cf-tag{padding:5px 12px;border-radius:20px;font-size:11px;font-weight:700;cursor:pointer;border:2px solid #E5E7EB;background:transparent;color:#6B7280;transition:all .15s;font-family:'DM Sans',sans-serif;}
.cf-tag.sel{background:#FF3E7F;border-color:#FF3E7F;color:#fff;}
.cf-tag-custom-row{display:flex;align-items:center;gap:8px;padding:6px 14px 12px;}
.cf-tag-inp{flex:1;border:none;border-bottom:2px solid #E5E7EB;outline:none;font-family:'DM Sans',sans-serif;font-size:12px;color:#1A1A2E;background:transparent;padding:4px 0;}
.cf-tag-inp::placeholder{color:#C7C7CC;}
.cf-tag-add-btn{width:28px;height:28px;border-radius:50%;background:#FF3E7F;color:#fff;border:none;font-size:20px;line-height:1;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;}

/* Ingredients */
.cf-ing-list{padding:2px 14px 6px;}
.cf-ing-item{display:flex;align-items:center;gap:8px;padding:7px 0;border-bottom:1px solid #F5F5F7;}
.cf-ing-item:last-child{border-bottom:none;}
.cf-ing-name{flex:1;border:none;outline:none;font-family:'DM Sans',sans-serif;font-size:13px;color:#1A1A2E;background:transparent;padding:0;}
.cf-ing-name::placeholder,.cf-ing-qty::placeholder{color:#C7C7CC;}
.cf-ing-qty{width:72px;border:none;outline:none;font-family:'DM Sans',sans-serif;font-size:12px;color:#6B7280;background:transparent;text-align:right;}
.cf-ing-del{width:22px;height:22px;border-radius:50%;background:#FEE2E2;border:none;color:#EF4444;font-size:15px;line-height:1;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.cf-add-ing{display:flex;align-items:center;gap:6px;padding:8px 14px;cursor:pointer;font-size:12px;font-weight:700;color:#FF3E7F;}

/* Steps textarea */
.cf-textarea{width:100%;box-sizing:border-box;border:none;outline:none;font-family:'DM Sans',sans-serif;font-size:13px;color:#1A1A2E;background:transparent;resize:none;min-height:100px;line-height:1.7;padding:10px 14px;}
.cf-textarea::placeholder{color:#C7C7CC;}

/* Saved custom recipes list */
.cr-list{display:flex;flex-direction:column;gap:0;}
.cr-recipe-row{display:flex;align-items:center;gap:12px;padding:12px 14px;background:#fff;border-bottom:1px solid #F5F5F7;cursor:pointer;transition:background .15s;}
.cr-recipe-row:first-child{border-radius:14px 14px 0 0;}
.cr-recipe-row:last-child{border-bottom:none;border-radius:0 0 14px 14px;}
.cr-recipe-row:only-child{border-radius:14px;}
.cr-recipe-row:hover{background:#FFF5F8;}
.cr-recipe-emoji{font-size:30px;width:46px;height:46px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.cr-recipe-info{flex:1;min-width:0;}
.cr-recipe-title{font-size:13px;font-weight:700;color:#1A1A2E;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.cr-recipe-meta{font-size:11px;color:#9CA3AF;margin-top:2px;}
.cr-recipe-del{width:30px;height:30px;border-radius:50%;background:#F3F4F6;border:none;color:#9CA3AF;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s;}
.cr-recipe-del:hover{background:#FEE2E2;color:#EF4444;}
.cr-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;text-align:center;gap:10px;}
.cr-empty-icon{font-size:52px;opacity:.25;}
.cr-empty-title{font-family:'Playfair Display',Georgia,serif;font-size:18px;font-weight:700;color:#1A1A2E;}
.cr-empty-sub{font-size:12px;color:#9CA3AF;line-height:1.7;}
/* Save button at bottom of form */
.cf-submit{width:calc(100% - 28px);margin:4px 14px 8px;padding:14px;background:#FF3E7F;color:#fff;border:none;border-radius:14px;font-family:'DM Sans',sans-serif;font-size:14px;font-weight:700;cursor:pointer;box-shadow:0 6px 20px rgba(255,62,127,.35);transition:transform .15s,box-shadow .15s;}
.cf-submit:active{transform:scale(.97);box-shadow:0 2px 8px rgba(255,62,127,.3);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROFILE / SETTINGS SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#profile{background:#F2F2F7;}
.prof2-hdr{display:flex;align-items:center;padding:14px 18px 8px;flex-shrink:0;gap:10px;}
.prof2-back{width:34px;height:34px;border-radius:50%;background:#fff;border:none;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 4px rgba(0,0,0,.1);}
.prof2-title{font-family:'Playfair Display',Georgia,serif;font-size:20px;font-weight:900;color:#1A1A2E;flex:1;}
.prof2-body{flex:1;overflow-y:auto;padding:0 14px 30px;}
.prof2-avatar{display:flex;flex-direction:column;align-items:center;padding:20px 0 16px;gap:8px;}
.prof2-av-circle{width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,#FF3E7F,#FF8C42);display:flex;align-items:center;justify-content:center;font-size:32px;box-shadow:0 4px 16px rgba(255,62,127,.3);}
.prof2-av-name{font-family:'Playfair Display',Georgia,serif;font-size:18px;font-weight:700;color:#1A1A2E;}
.prof2-av-sub{font-size:11px;color:#9CA3AF;}
.prof2-sec{margin-bottom:14px;}
.prof2-sec-title{font-size:9px;font-weight:700;color:#9CA3AF;letter-spacing:.8px;text-transform:uppercase;padding:0 4px 6px;}
.prof2-card{background:#fff;border-radius:14px;overflow:hidden;box-shadow:0 1px 5px rgba(0,0,0,.05);}
.prof2-row{display:flex;align-items:center;min-height:46px;padding:0 14px;border-bottom:1px solid #F5F5F7;gap:10px;}
.prof2-row:last-child{border-bottom:none;}
.prof2-row-ic{font-size:18px;width:26px;text-align:center;flex-shrink:0;}
.prof2-row-lbl{flex:1;font-size:13px;font-weight:500;color:#1A1A2E;}
.prof2-row-val{font-size:12px;color:#9CA3AF;max-width:140px;text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.prof2-row-arr{font-size:16px;color:#C7C7CC;margin-left:4px;}
.prof2-inp{flex:1;border:none;outline:none;font-family:'DM Sans',sans-serif;font-size:13px;color:#1A1A2E;background:transparent;text-align:right;padding:10px 0;}
.prof2-inp::placeholder{color:#C7C7CC;}
/* Diet options */
.prof2-diet-grid{display:flex;flex-direction:column;gap:0;}
.prof2-diet-opt{display:flex;align-items:center;padding:12px 14px;border-bottom:1px solid #F5F5F7;cursor:pointer;transition:background .15s;gap:10px;}
.prof2-diet-opt:last-child{border-bottom:none;}
.prof2-diet-opt.sel{background:#FFF5F8;}
.prof2-diet-ic{font-size:22px;flex-shrink:0;}
.prof2-diet-info{flex:1;}
.prof2-diet-info h4{font-size:13px;font-weight:600;color:#1A1A2E;margin:0;}
.prof2-diet-info p{font-size:11px;color:#9CA3AF;margin:2px 0 0;}
.prof2-diet-chk{width:22px;height:22px;border-radius:50%;border:2px solid #E5E7EB;display:flex;align-items:center;justify-content:center;font-size:12px;color:#fff;flex-shrink:0;transition:all .18s;}
.prof2-diet-opt.sel .prof2-diet-chk{background:#FF3E7F;border-color:#FF3E7F;}
/* Allergy chips */
.prof2-allergy-grid{display:flex;flex-wrap:wrap;gap:8px;padding:12px 14px;}
.prof2-allergy-chip{display:flex;align-items:center;gap:5px;padding:6px 12px;border-radius:20px;border:2px solid #E5E7EB;background:#F9F9F9;cursor:pointer;font-size:12px;font-weight:600;color:#6B7280;transition:all .15s;}
.prof2-allergy-chip.sel{background:#FFF5F8;border-color:#FF3E7F;color:#FF3E7F;}
/* Disliked tags */
.prof2-dislike-wrap{display:flex;flex-wrap:wrap;gap:7px;padding:10px 14px 6px;}
.prof2-dislike-tag{display:flex;align-items:center;gap:4px;padding:5px 10px;border-radius:20px;background:#F3F4F6;font-size:12px;font-weight:600;color:#6B7280;}
.prof2-dislike-tag button{background:none;border:none;color:#9CA3AF;font-size:14px;cursor:pointer;padding:0;line-height:1;}
.prof2-dislike-inp-row{display:flex;align-items:center;gap:8px;padding:6px 14px 12px;}
.prof2-dislike-inp{flex:1;border:none;border-bottom:2px solid #E5E7EB;outline:none;font-family:'DM Sans',sans-serif;font-size:12px;color:#1A1A2E;background:transparent;padding:4px 0;}
.prof2-dislike-inp::placeholder{color:#C7C7CC;}
.prof2-dislike-add{width:28px;height:28px;border-radius:50%;background:#FF3E7F;color:#fff;border:none;font-size:20px;line-height:1;cursor:pointer;display:flex;align-items:center;justify-content:center;}
/* Save button */
.prof2-save{width:calc(100% - 28px);margin:4px 14px 8px;padding:14px;background:#FF3E7F;color:#fff;border:none;border-radius:14px;font-family:'DM Sans',sans-serif;font-size:14px;font-weight:700;cursor:pointer;box-shadow:0 6px 20px rgba(255,62,127,.3);transition:transform .15s;}
.prof2-save:active{transform:scale(.97);}
/* Danger zone */
.prof2-danger{color:#EF4444 !important;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SWIPE END SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#swipe-end{display:none;flex-direction:column;align-items:center;justify-content:center;padding:40px 30px;text-align:center;gap:16px;position:absolute;inset:0;background:#fff;z-index:10;border-radius:inherit;}
.swipe-end-icon{font-size:64px;animation:bounce .8s ease infinite alternate;}
@keyframes bounce{from{transform:translateY(0);}to{transform:translateY(-12px);}}
.swipe-end-title{font-family:'Playfair Display',Georgia,serif;font-size:22px;font-weight:900;color:#1A1A2E;line-height:1.3;}
.swipe-end-sub{font-size:13px;color:#6B7280;line-height:1.7;max-width:260px;}
.swipe-end-btns{display:flex;flex-direction:column;gap:10px;width:100%;}
.swipe-end-btn-primary{padding:14px;background:#FF3E7F;color:#fff;border:none;border-radius:14px;font-family:'DM Sans',sans-serif;font-size:14px;font-weight:700;cursor:pointer;box-shadow:0 6px 20px rgba(255,62,127,.3);}
.swipe-end-btn-secondary{padding:14px;background:#F3F4F6;color:#1A1A2E;border:none;border-radius:14px;font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;cursor:pointer;}

/* Profile button in main header */
.btn-profile{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,#FF3E7F,#FF8C42);border:none;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px rgba(255,62,127,.3);transition:transform .15s;}
.btn-profile:active{transform:scale(.9);}
</style>
</head>
<body>
<div class="phone" id="app">
  <div class="overlay" id="overlay"></div>
  <div class="toast" id="toast"></div>

  <!-- â•â• SPLASH â•â• -->
  <div class="screen active" id="splash">
    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;flex:1;text-align:center;">
      <div class="splash-emoji">ğŸ½ï¸</div>
      <div class="splash-logo">RECIPY</div>
      <div class="splash-sub">Planifiez, cuisinez, savourez</div>
      <button class="splash-btn" id="btn-start">Commencer</button>
    </div>
  </div>

  <!-- â•â• ONBOARD â•â• -->
  <div class="screen" id="onboard">
    <div class="status-bar"><span>9:41</span><span>â–²â–² ğŸ”‹</span></div>
    <div class="page-body">
      <div class="dots"><div class="dot active"></div><div class="dot"></div><div class="dot"></div></div>
      <div style="font-size:48px;margin-bottom:14px;">ğŸ‘‹</div>
      <div class="page-title">Bienvenue sur Recipy</div>
      <div class="page-sub">CrÃ©ez votre compte pour commencer</div>
      <div class="input-group"><label>PrÃ©nom</label><input type="text" placeholder="Marie"></div>
      <div class="input-group"><label>Email</label><input type="email" placeholder="marie@exemple.fr"></div>
      <div class="input-group"><label>Mot de passe</label><input type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
      <button class="btn-p" id="btn-to-allergies">CrÃ©er mon compte</button>
      <div class="or-div">ou</div>
      <button class="btn-s" id="btn-login">Se connecter</button>
    </div>
  </div>

  <!-- â•â• ALLERGIES â•â• -->
  <div class="screen" id="allergies">
    <div class="status-bar"><span>9:41</span><span>â–²â–² ğŸ”‹</span></div>
    <div class="page-body">
      <div class="dots"><div class="dot"></div><div class="dot active"></div><div class="dot"></div></div>
      <div class="page-title">Vos allergies</div>
      <div class="page-sub">SÃ©lectionnez ce que vous Ã©vitez</div>
      <div class="allergy-grid">
        <div class="allergy-chip"><span class="ci">ğŸ¥œ</span><span class="cl">Arachides</span></div>
        <div class="allergy-chip"><span class="ci">ğŸ¥›</span><span class="cl">Lactose</span></div>
        <div class="allergy-chip"><span class="ci">ğŸŒ¾</span><span class="cl">Gluten</span></div>
        <div class="allergy-chip"><span class="ci">ğŸ¦</span><span class="cl">CrustacÃ©s</span></div>
        <div class="allergy-chip"><span class="ci">ğŸ¥š</span><span class="cl">Oeufs</span></div>
        <div class="allergy-chip"><span class="ci">ğŸŸ</span><span class="cl">Poisson</span></div>
        <div class="allergy-chip"><span class="ci">ğŸŒ°</span><span class="cl">Noix</span></div>
        <div class="allergy-chip"><span class="ci">ğŸ«˜</span><span class="cl">Soja</span></div>
      </div>
      <button class="btn-p" id="btn-to-diet">Continuer</button>
      <button class="btn-s" id="btn-skip-a">Passer</button>
    </div>
  </div>

  <!-- â•â• DIET â•â• -->
  <div class="screen" id="diet">
    <div class="status-bar"><span>9:41</span><span>â–²â–² ğŸ”‹</span></div>
    <div class="page-body">
      <div class="dots"><div class="dot"></div><div class="dot"></div><div class="dot active"></div></div>
      <div class="page-title">Votre rÃ©gime</div>
      <div class="page-sub">Pour des recettes adaptÃ©es</div>
      <div class="diet-opt selected" id="diet0"><div class="diet-ic">ğŸ–</div><div class="diet-inf"><h4>Omnivore</h4><p>Je mange de tout</p></div><div class="diet-chk">âœ“</div></div>
      <div class="diet-opt" id="diet1"><div class="diet-ic">ğŸ¥—</div><div class="diet-inf"><h4>VÃ©gÃ©tarien</h4><p>Pas de viande ni poisson</p></div><div class="diet-chk"></div></div>
      <div class="diet-opt" id="diet2"><div class="diet-ic">ğŸŒ±</div><div class="diet-inf"><h4>Vegan</h4><p>Aucun produit animal</p></div><div class="diet-chk"></div></div>
      <div class="diet-opt" id="diet3"><div class="diet-ic">ğŸ¥©</div><div class="diet-inf"><h4>Keto</h4><p>Faible en glucides</p></div><div class="diet-chk"></div></div>
      <button class="btn-p" id="btn-to-main">C'est parti ! ğŸ‰</button>
    </div>
  </div>

  <!-- â•â• MAIN SWIPE â•â• -->
  <div class="screen" id="main">
    <div class="status-bar"><span>9:41</span><span>â–²â–² ğŸ”‹</span></div>
    <div class="main-hdr">
      <div class="main-title">Recipy</div>
      <button class="icon-btn" id="btn-filter">ğŸ”§</button>
      <button class="btn-profile" id="btn-open-profile">ğŸ‘¤</button>
    </div>
    <div class="filt-bar">
      <div class="filt-pill active" id="fp0">Tout</div>
      <div class="filt-pill" id="fp1">ğŸ Pasta</div>
      <div class="filt-pill" id="fp2">ğŸ¥— Salade</div>
      <div class="filt-pill" id="fp3">ğŸœ Soupe</div>
      <div class="filt-pill" id="fp4">ğŸ° Dessert</div>
    </div>
    <div class="card-area" style="position:relative;">
      <!-- Swipe end overlay -->
      <div id="swipe-end">
        <div class="swipe-end-icon">ğŸ‰</div>
        <div class="swipe-end-title">Vous avez tout vu !</div>
        <div class="swipe-end-sub">Vous avez explorÃ© toutes les recettes disponibles pour votre profil.</div>
        <div class="swipe-end-btns">
          <button class="swipe-end-btn-primary" id="btn-swipe-restart">ğŸ”„ Recommencer le swipe</button>
          <button class="swipe-end-btn-secondary" id="btn-swipe-go-saved">â™¥ Voir mes recettes likÃ©es</button>
        </div>
      </div>
      <div class="recipe-card" id="swipe-card">
        <div class="swipe-badge left" id="badge-left">âœ• PASSER</div>
        <div class="swipe-badge right" id="badge-right">â˜… SAUVER</div>
        <div class="card-img" id="card-img"><div class="card-ov"></div></div>
        <div class="card-body">
          <div class="card-tags"><div class="card-tag" id="ctag1"></div><div class="card-tag" id="ctag2"></div></div>
          <div class="card-title" id="ctitle"></div>
          <div class="card-desc" id="cdesc"></div>
          <div class="card-meta">
            <div class="card-meta-item">â±ï¸ <span id="ctime"></span></div>
            <div class="card-meta-item">ğŸ‘¤ 2 pers.</div>
            <div class="card-meta-item">â­ 4.8</div>
          </div>
        </div>
      </div>
    </div>
    <div class="swipe-actions">
      <button class="act-btn act-pass" id="btn-pass">âœ•</button>
      <button class="act-btn act-info" id="btn-info">â„¹</button>
      <button class="act-btn act-save" id="btn-save">â˜…</button>
    </div>
    <nav class="bottom-nav">
      <div class="nav-indicator"></div>
      <button class="nav-btn active" data-tab="0" data-goto="main"><div class="nav-icon">ğŸ´</div><div class="nav-label">Accueil</div></button>
      <button class="nav-btn" data-tab="1" data-goto="saved"><div class="nav-icon">â™¥<span class="nav-badge"></span></div><div class="nav-label">Recettes</div></button>
      <button class="nav-btn" data-tab="2" data-goto="calendar"><div class="nav-icon">ğŸ“…<span class="nav-badge" id="cal-badge-main"></span></div><div class="nav-label">Planning</div></button>
      <button class="nav-btn" data-tab="3" data-goto="shopping"><div class="nav-icon">ğŸ›’<span class="nav-badge" id="shop-badge-main"></span></div><div class="nav-label">Courses</div></button>
    
      <button class="nav-btn" data-tab="4" data-goto="create"><div class="nav-icon">âœï¸</div><div class="nav-label">CrÃ©er</div></button>
    </nav>
  </div>

  <!-- â•â• DETAIL â•â• -->
  <div class="screen" id="detail">
    <div class="det-img" id="det-img">
      <button class="det-back" id="btn-det-back">â†</button>
      <button class="det-fav" id="btn-det-fav">â˜…</button>
    </div>
    <div class="det-body">
      <div class="card-tags" style="margin-bottom:7px;"><div class="card-tag" id="det-tag1"></div><div class="card-tag" id="det-tag2"></div></div>
      <div class="det-title" id="det-title"></div>
      <div class="det-desc" id="det-desc"></div>
      <div class="portion-ctrl">
        <div class="portion-lbl">ğŸ½ï¸ Portions</div>
        <div class="portion-btns">
          <button class="portion-btn" id="btn-pm">âˆ’</button>
          <div class="portion-num" id="pnum">2</div>
          <button class="portion-btn" id="btn-pp">+</button>
        </div>
      </div>
      <button class="btn-planning" id="btn-add-to-planning">ğŸ“… Ajouter au planning</button>
      <div class="sec-title">IngrÃ©dients</div>
      <div class="ing-list" id="det-ing"></div>
      <div class="sec-title">Instructions</div>
      <div class="steps" id="det-steps"></div>
    </div>
    <nav class="bottom-nav">
      <div class="nav-indicator"></div>
      <button class="nav-btn active" data-tab="0" data-goto="main"><div class="nav-icon">ğŸ´</div><div class="nav-label">Accueil</div></button>
      <button class="nav-btn" data-tab="1" data-goto="saved"><div class="nav-icon">â™¥<span class="nav-badge"></span></div><div class="nav-label">Recettes</div></button>
      <button class="nav-btn" data-tab="2" data-goto="calendar"><div class="nav-icon">ğŸ“…</div><div class="nav-label">Planning</div></button>
      <button class="nav-btn" data-tab="3" data-goto="shopping"><div class="nav-icon">ğŸ›’</div><div class="nav-label">Courses</div></button>
    
      <button class="nav-btn" data-tab="4" data-goto="create"><div class="nav-icon">âœï¸</div><div class="nav-label">CrÃ©er</div></button>
    </nav>
  </div>

  <!-- â•â• SAVED â•â• -->
  <div class="screen" id="saved">
    <div class="status-bar"><span>9:41</span><span>â–²â–² ğŸ”‹</span></div>
    <div class="saved-topbar">
      <div><div class="main-title">Mes Recettes</div><div class="count-label" id="saved-count-label">0 recette</div></div>
    </div>
    <!-- sel-toolbar kept for JS compat -->
    <div class="sel-toolbar" id="sel-toolbar" style="display:none!important">
      <span class="sel-info" id="sel-info"></span>
      <div class="sel-actions">
        <button class="sel-btn all" id="btn-sel-all"></button>
        <button class="sel-btn del" id="btn-del-selected"></button>
        <button class="sel-btn cancel" id="btn-cancel-sel"></button>
        <button class="sel-btn all" id="btn-select-mode" style="display:none"></button>
      </div>
    </div>
    <div id="saved-content" style="flex:1;display:flex;flex-direction:column;overflow:hidden;min-height:0;"></div>
    <nav class="bottom-nav">
      <div class="nav-indicator"></div>
      <button class="nav-btn" data-tab="0" data-goto="main"><div class="nav-icon">ğŸ´</div><div class="nav-label">Accueil</div></button>
      <button class="nav-btn active" data-tab="1" data-goto="saved"><div class="nav-icon">â™¥<span class="nav-badge"></span></div><div class="nav-label">Recettes</div></button>
      <button class="nav-btn" data-tab="2" data-goto="calendar"><div class="nav-icon">ğŸ“…</div><div class="nav-label">Planning</div></button>
      <button class="nav-btn" data-tab="3" data-goto="shopping"><div class="nav-icon">ğŸ›’</div><div class="nav-label">Courses</div></button>
    
      <button class="nav-btn" data-tab="4" data-goto="create"><div class="nav-icon">âœï¸</div><div class="nav-label">CrÃ©er</div></button>
    </nav>
  </div>

  <!-- â•â• CALENDRIER â•â• -->
  <div class="screen" id="calendar" style="flex-direction:column;">
    <div class="status-bar"><span>9:41</span><span>â–²â–² ğŸ”‹</span></div>
    <div class="cal-hdr">
      <div class="main-title">Planning</div>
      <button class="icon-btn" id="btn-clear-week" title="Vider la semaine">ğŸ—‘ï¸</button>
    </div>
    <!-- 7 day strip -->
    <!-- Planning indicator -->
    <div id="cal-shop-indicator" style="margin:0 12px 6px;padding:8px 12px;background:#FFF5F8;border-radius:10px;display:none;flex-shrink:0;align-items:center;justify-content:space-between;gap:8px;"></div>
    <div class="week-strip" id="week-strip" style="display:flex;flex-direction:row;width:100%;flex-shrink:0;padding:0 12px 10px;box-sizing:border-box;"></div>
    <div class="cal-body" id="cal-body" style="flex:1;overflow-y:auto;padding:0 12px 16px;"></div>
    <nav class="bottom-nav">
      <div class="nav-indicator"></div>
      <button class="nav-btn" data-tab="0" data-goto="main"><div class="nav-icon">ğŸ´</div><div class="nav-label">Accueil</div></button>
      <button class="nav-btn" data-tab="1" data-goto="saved"><div class="nav-icon">â™¥<span class="nav-badge"></span></div><div class="nav-label">Recettes</div></button>
      <button class="nav-btn active" data-tab="2" data-goto="calendar"><div class="nav-icon">ğŸ“…</div><div class="nav-label">Planning</div></button>
      <button class="nav-btn" data-tab="3" data-goto="shopping"><div class="nav-icon">ğŸ›’</div><div class="nav-label">Courses</div></button>
    
      <button class="nav-btn" data-tab="4" data-goto="create"><div class="nav-icon">âœï¸</div><div class="nav-label">CrÃ©er</div></button>
    </nav>
  </div>

  <!-- â•â• LISTE DE COURSES â•â• -->
  <div class="screen" id="shopping" style="flex-direction:column;background:#F2F2F7;">
    <div class="status-bar"><span>9:41</span><span>â–²â–² ğŸ”‹</span></div>
    <!-- HEADER -->
    <div style="padding:14px 18px 8px;flex-shrink:0;">
      <div style="font-size:24px;font-weight:900;color:#1A1A2E;font-family:inherit;">Liste de courses</div>
      <div id="shop-week-label" style="font-size:11px;font-weight:600;color:#FF3E7F;margin-top:2px;"></div>
      <div id="shop-count-label" style="font-size:11px;color:#6B7280;margin-top:1px;">GÃ©nÃ©rÃ©e depuis le planning</div>
      <div id="shop-cost-label" style="display:none;margin-top:6px;display:inline-flex;align-items:center;gap:6px;background:#FFF5F8;border-radius:20px;padding:4px 10px 4px 8px;">
        <span style="font-size:14px;">ğŸ’°</span>
        <span id="shop-cost-value" style="font-size:13px;font-weight:700;color:#FF3E7F;"></span>
        <span style="font-size:10px;color:#9CA3AF;">estimÃ©</span>
      </div>
    </div>
    <!-- Recettes source -->
    <div id="shop-recipes-summary" style="margin:0 14px 10px;padding:10px 14px;background:#fff;border-radius:12px;box-shadow:0 1px 4px rgba(0,0,0,.06);flex-shrink:0;display:none;"></div>
    <!-- BODY (populated by JS) -->
    <div id="shop-body" style="flex:1;overflow-y:auto;padding:0 14px 14px;"></div>
    <nav class="bottom-nav">
      <div class="nav-indicator"></div>
      <button class="nav-btn" data-tab="0" data-goto="main"><div class="nav-icon">ğŸ´</div><div class="nav-label">Accueil</div></button>
      <button class="nav-btn" data-tab="1" data-goto="saved"><div class="nav-icon">â™¥<span class="nav-badge"></span></div><div class="nav-label">Recettes</div></button>
      <button class="nav-btn" data-tab="2" data-goto="calendar"><div class="nav-icon">ğŸ“…</div><div class="nav-label">Planning</div></button>
      <button class="nav-btn active" data-tab="3" data-goto="shopping"><div class="nav-icon">ğŸ›’</div><div class="nav-label">Courses</div></button>
    
      <button class="nav-btn" data-tab="4" data-goto="create"><div class="nav-icon">âœï¸</div><div class="nav-label">CrÃ©er</div></button>
    </nav>
  </div>

  <!-- â•â• PREFS â•â• -->
  <div class="screen" id="prefs">
    <div class="status-bar"><span>9:41</span><span>â–²â–² ğŸ”‹</span></div>
    <div class="prefs-body">
      <div class="prof-hdr"><div class="prof-av">ğŸ‘©</div><div class="prof-name">Marie Dupont</div><div class="prof-sub"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="fa979b88939fba9f829f978a969fd49c88">[email&#160;protected]</a> â€¢ VÃ©gÃ©tarien</div></div>
      <div class="prefs-sec">
        <div class="prefs-row"><div class="prefs-ic">ğŸ¥—</div><div class="prefs-lbl">RÃ©gime alimentaire</div><div class="prefs-arr">â€º</div></div>
        <div class="prefs-row"><div class="prefs-ic">âš ï¸</div><div class="prefs-lbl">Allergies</div><div class="prefs-arr">â€º</div></div>
      </div>
      <div class="prefs-sec">
        <div class="prefs-row" id="tog0"><div class="prefs-ic">ğŸ””</div><div class="prefs-lbl">Notifications</div><div class="toggle on"></div></div>
        <div class="prefs-row" id="tog1"><div class="prefs-ic">ğŸŒ™</div><div class="prefs-lbl">Mode sombre</div><div class="toggle"></div></div>
        <div class="prefs-row" id="tog2"><div class="prefs-ic">ğŸŒ</div><div class="prefs-lbl">Recettes internationales</div><div class="toggle on"></div></div>
      </div>
      <div class="prefs-sec">
        <div class="prefs-row" id="btn-logout"><div class="prefs-ic">ğŸšª</div><div class="prefs-lbl" style="color:var(--pink)">Se dÃ©connecter</div></div>
      </div>
    </div>
    <nav class="bottom-nav">
      <div class="nav-indicator"></div>
      <button class="nav-btn" data-tab="0" data-goto="main"><div class="nav-icon">ğŸ´</div><div class="nav-label">Accueil</div></button>
      <button class="nav-btn" data-tab="1" data-goto="saved"><div class="nav-icon">â™¥<span class="nav-badge"></span></div><div class="nav-label">Recettes</div></button>
      <button class="nav-btn" data-tab="2" data-goto="calendar"><div class="nav-icon">ğŸ“…</div><div class="nav-label">Planning</div></button>
      <button class="nav-btn" data-tab="3" data-goto="shopping"><div class="nav-icon">ğŸ›’</div><div class="nav-label">Courses</div></button>
    
      <button class="nav-btn" data-tab="4" data-goto="create"><div class="nav-icon">âœï¸</div><div class="nav-label">CrÃ©er</div></button>
    </nav>
  </div>

  <!-- â•â• MODAL: Filtre swipe â•â• -->
  <div class="modal" id="filt-modal">
    <div class="modal-handle"></div>
    <div class="modal-title">Filtrer</div>
    <div class="filt-sec-title">Temps</div>
    <div class="filt-chips">
      <div class="filt-chip selected" id="fc0">âš¡ &lt;15 min</div>
      <div class="filt-chip" id="fc1">ğŸ• 15â€“30 min</div>
      <div class="filt-chip" id="fc2">ğŸ•‘ 30â€“60 min</div>
    </div>
    <div class="filt-sec-title">DifficultÃ©</div>
    <div class="filt-chips">
      <div class="filt-chip selected" id="fc3">ğŸ˜Š Facile</div>
      <div class="filt-chip" id="fc4">ğŸ¤” Moyen</div>
      <div class="filt-chip" id="fc5">ğŸ‘©â€ğŸ³ Expert</div>
    </div>
    <button class="btn-p" id="btn-apply-filt" style="margin-top:16px;">Appliquer</button>
  </div>

  <!-- â•â• MODAL: Ajouter au planning â•â• -->
  <div class="modal" id="plan-modal">
    <div class="modal-handle"></div>
    <div class="modal-title">Ajouter au planning</div>
    <div style="font-size:11px;font-weight:700;color:var(--gray);letter-spacing:.5px;text-transform:uppercase;margin-bottom:8px;">Jour</div>
    <div class="plan-day-grid" id="plan-day-grid"></div>
    <div style="font-size:11px;font-weight:700;color:var(--gray);letter-spacing:.5px;text-transform:uppercase;margin-bottom:8px;">Moment</div>
    <div class="plan-time-row">
      <button class="plan-time-btn selected" id="pt-midi">ğŸŒ¤ï¸ Midi</button>
      <button class="plan-time-btn" id="pt-soir">ğŸŒ™ Soir</button>
    </div>
    <button class="btn-p" id="btn-confirm-plan">Confirmer</button>
  </div>

  <!-- â•â• CREATE RECIPE â•â• -->
  <div class="screen" id="create" style="flex-direction:column;">
    <div class="status-bar"><span>9:41</span><span>â–²â–² ğŸ”‹</span></div>

    <!-- Header -->
    <div class="cr-hdr">
      <div class="cr-title">Mes CrÃ©ations</div>
      <button class="cr-btn-new" id="btn-show-form">+ Nouvelle</button>
    </div>

    <!-- Tabs: liste | formulaire -->
    <div class="cr-tabs">
      <div class="cr-tab active" id="cr-tab-list" style="cursor:pointer;">Mes recettes</div>
      <div class="cr-tab" id="cr-tab-form" style="cursor:pointer;">CrÃ©er une recette</div>
    </div>

    <!-- LIST PANEL -->
    <div class="cr-body" id="cr-panel-list">
      <div id="cr-list-content"></div>
    </div>

    <!-- FORM PANEL (hidden by default) -->
    <div class="cr-body" id="cr-panel-form" style="display:none;">

      <!-- Photo -->
      <div class="cf-photo" id="cf-photo-zone">
        <div class="cf-photo-icon">ğŸ“·</div>
        <div class="cf-photo-lbl">Ajouter une photo (optionnel)</div>
        <input type="file" id="cf-photo-input" accept="image/*" style="display:none;">
      </div>

      <!-- Emoji + couleur card -->
      <div class="cf-card">
        <div class="cf-card-title">Apparence dans le swipe</div>
        <div class="cf-emoji-row" id="cf-emoji-picker">
          <button class="cf-emoji-btn sel" data-emoji="ğŸ³">ğŸ³</button>
          <button class="cf-emoji-btn" data-emoji="ğŸ¥˜">ğŸ¥˜</button>
          <button class="cf-emoji-btn" data-emoji="ğŸœ">ğŸœ</button>
          <button class="cf-emoji-btn" data-emoji="ğŸ¥—">ğŸ¥—</button>
          <button class="cf-emoji-btn" data-emoji="ğŸ•">ğŸ•</button>
          <button class="cf-emoji-btn" data-emoji="ğŸ°">ğŸ°</button>
          <button class="cf-emoji-btn" data-emoji="ğŸ¥©">ğŸ¥©</button>
          <button class="cf-emoji-btn" data-emoji="ğŸ±">ğŸ±</button>
          <button class="cf-emoji-btn" data-emoji="ğŸŒ®">ğŸŒ®</button>
          <button class="cf-emoji-btn" data-emoji="ğŸ¥ª">ğŸ¥ª</button>
        </div>
        <div class="cf-grad-row" id="cf-grad-picker">
          <div class="cf-swatch sel" data-grad="linear-gradient(135deg,#FF6B6B,#FFE66D)" style="background:linear-gradient(135deg,#FF6B6B,#FFE66D);"></div>
          <div class="cf-swatch" data-grad="linear-gradient(135deg,#a8edea,#fed6e3)" style="background:linear-gradient(135deg,#a8edea,#fed6e3);"></div>
          <div class="cf-swatch" data-grad="linear-gradient(135deg,#84fab0,#8fd3f4)" style="background:linear-gradient(135deg,#84fab0,#8fd3f4);"></div>
          <div class="cf-swatch" data-grad="linear-gradient(135deg,#f6d365,#fda085)" style="background:linear-gradient(135deg,#f6d365,#fda085);"></div>
          <div class="cf-swatch" data-grad="linear-gradient(135deg,#f093fb,#f5576c)" style="background:linear-gradient(135deg,#f093fb,#f5576c);"></div>
          <div class="cf-swatch" data-grad="linear-gradient(135deg,#4facfe,#00f2fe)" style="background:linear-gradient(135deg,#4facfe,#00f2fe);"></div>
          <div class="cf-swatch" data-grad="linear-gradient(135deg,#43e97b,#38f9d7)" style="background:linear-gradient(135deg,#43e97b,#38f9d7);"></div>
          <div class="cf-swatch" data-grad="linear-gradient(135deg,#fa709a,#fee140)" style="background:linear-gradient(135deg,#fa709a,#fee140);"></div>
        </div>
      </div>

      <!-- Infos principales -->
      <div class="cf-card">
        <div class="cf-card-title">Informations</div>
        <div class="cf-row">
          <span class="cf-lbl">Titre *</span>
          <input class="cf-inp" id="cf-title" type="text" placeholder="Ma recette maison" maxlength="50">
        </div>
        <div class="cf-row">
          <span class="cf-lbl">Description</span>
          <input class="cf-inp" id="cf-desc" type="text" placeholder="En deux mots..." maxlength="120">
        </div>
        <div class="cf-row">
          <span class="cf-lbl">Temps de prÃ©p.</span>
          <input class="cf-inp" id="cf-time" type="text" placeholder="ex: 30 min" maxlength="20">
        </div>
        <div class="cf-row">
          <span class="cf-lbl">Portions</span>
          <input class="cf-inp" id="cf-portions" type="number" min="1" max="20" placeholder="2" style="max-width:60px;">
        </div>
        <div class="cf-row">
          <span class="cf-lbl">Nb personnes</span>
          <input class="cf-inp" id="cf-persons" type="number" min="1" max="20" placeholder="2" style="max-width:60px;">
        </div>
      </div>

      <!-- Tags -->
      <div class="cf-card">
        <div class="cf-card-title">CatÃ©gories / Tags</div>
        <div class="cf-tags-wrap" id="cf-tags-preset">
          <button class="cf-tag sel" data-tag="MAISON">MAISON</button>
          <button class="cf-tag" data-tag="RAPIDE">RAPIDE</button>
          <button class="cf-tag" data-tag="VÃ‰GÃ‰TARIEN">VÃ‰GÃ‰TARIEN</button>
          <button class="cf-tag" data-tag="Ã‰PICÃ‰">Ã‰PICÃ‰</button>
          <button class="cf-tag" data-tag="DESSERT">DESSERT</button>
          <button class="cf-tag" data-tag="PASTA">PASTA</button>
          <button class="cf-tag" data-tag="FAMILIAL">FAMILIAL</button>
          <button class="cf-tag" data-tag="HEALTHY">HEALTHY</button>
          <button class="cf-tag" data-tag="CLASSIQUE">CLASSIQUE</button>
          <button class="cf-tag" data-tag="FRAIS">FRAIS</button>
        </div>
        <div class="cf-tag-custom-row">
          <input class="cf-tag-inp" id="cf-tag-custom" type="text" placeholder="Tag personnalisÃ©â€¦" maxlength="20">
          <button class="cf-tag-add-btn" id="cf-tag-add-btn">+</button>
        </div>
      </div>

      <!-- IngrÃ©dients -->
      <div class="cf-card">
        <div class="cf-card-title">IngrÃ©dients</div>
        <div class="cf-ing-list" id="cf-ing-list"></div>
        <div class="cf-add-ing" id="cf-add-ing">
          <span style="font-size:18px;line-height:1;">+</span> Ajouter un ingrÃ©dient
        </div>
      </div>

      <!-- PrÃ©paration -->
      <div class="cf-card">
        <div class="cf-card-title">PrÃ©paration</div>
        <textarea class="cf-textarea" id="cf-steps" placeholder="DÃ©crivez les Ã©tapes de prÃ©paration...&#10;Vous pouvez Ã©crire librement."></textarea>
      </div>

      <!-- Submit -->
      <button class="cf-submit" id="cf-submit">âœ“ Enregistrer la recette</button>
    </div>

    <nav class="bottom-nav">
      <div class="nav-indicator"></div>
      <button class="nav-btn" data-tab="0" data-goto="main"><div class="nav-icon">ğŸ´</div><div class="nav-label">Accueil</div></button>
      <button class="nav-btn" data-tab="1" data-goto="saved"><div class="nav-icon">â™¥<span class="nav-badge"></span></div><div class="nav-label">Recettes</div></button>
      <button class="nav-btn" data-tab="2" data-goto="calendar"><div class="nav-icon">ğŸ“…<span class="nav-badge"></span></div><div class="nav-label">Planning</div></button>
      <button class="nav-btn" data-tab="3" data-goto="shopping"><div class="nav-icon">ğŸ›’<span class="nav-badge"></span></div><div class="nav-label">Courses</div></button>
      <button class="nav-btn active" data-tab="4" data-goto="create"><div class="nav-icon">âœï¸</div><div class="nav-label">CrÃ©er</div></button>
    </nav>
  </div>


  <!-- â•â• PROFILE / SETTINGS â•â• -->
  <div class="screen" id="profile" style="flex-direction:column;">
    <div class="status-bar"><span>9:41</span><span>â–²â–² ğŸ”‹</span></div>
    <div class="prof2-hdr">
      <button class="prof2-back" id="btn-profile-back">â€¹</button>
      <div class="prof2-title">Mon profil</div>
      <button class="prof2-save" id="btn-profile-save" style="width:auto;margin:0;padding:8px 16px;font-size:12px;box-shadow:none;">Sauvegarder</button>
    </div>

    <div class="prof2-body">
      <!-- Avatar -->
      <div class="prof2-avatar">
        <div class="prof2-av-circle">ğŸ‘¤</div>
        <div class="prof2-av-name" id="prof-display-name">Mon compte</div>
        <div class="prof2-av-sub" id="prof-display-diet">Omnivore</div>
      </div>

      <!-- Compte -->
      <div class="prof2-sec">
        <div class="prof2-sec-title">Compte</div>
        <div class="prof2-card">
          <div class="prof2-row">
            <span class="prof2-row-ic">âœ‰ï¸</span>
            <span class="prof2-row-lbl">Email</span>
            <input class="prof2-inp" id="prof-email" type="email" placeholder="mon@email.fr" maxlength="60">
          </div>
          <div class="prof2-row">
            <span class="prof2-row-ic">ğŸ”’</span>
            <span class="prof2-row-lbl">Mot de passe</span>
            <input class="prof2-inp" id="prof-password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" maxlength="40">
          </div>
          <div class="prof2-row">
            <span class="prof2-row-ic">ğŸ’³</span>
            <span class="prof2-row-lbl">Abonnement</span>
            <span class="prof2-row-val">Gratuit</span>
            <span class="prof2-row-arr">â€º</span>
          </div>
        </div>
      </div>

      <!-- RÃ©gime alimentaire -->
      <div class="prof2-sec">
        <div class="prof2-sec-title">RÃ©gime alimentaire</div>
        <div class="prof2-card prof2-diet-grid" id="prof-diet-grid">
          <div class="prof2-diet-opt sel" data-diet="Omnivore">
            <div class="prof2-diet-ic">ğŸ–</div>
            <div class="prof2-diet-info"><h4>Omnivore</h4><p>Je mange de tout</p></div>
            <div class="prof2-diet-chk">âœ“</div>
          </div>
          <div class="prof2-diet-opt" data-diet="VÃ©gÃ©tarien">
            <div class="prof2-diet-ic">ğŸ¥—</div>
            <div class="prof2-diet-info"><h4>VÃ©gÃ©tarien</h4><p>Pas de viande ni poisson</p></div>
            <div class="prof2-diet-chk"></div>
          </div>
          <div class="prof2-diet-opt" data-diet="Vegan">
            <div class="prof2-diet-ic">ğŸŒ±</div>
            <div class="prof2-diet-info"><h4>Vegan</h4><p>Aucun produit animal</p></div>
            <div class="prof2-diet-chk"></div>
          </div>
          <div class="prof2-diet-opt" data-diet="Keto">
            <div class="prof2-diet-ic">ğŸ¥©</div>
            <div class="prof2-diet-info"><h4>Keto</h4><p>Faible en glucides</p></div>
            <div class="prof2-diet-chk"></div>
          </div>
        </div>
      </div>

      <!-- Allergies -->
      <div class="prof2-sec">
        <div class="prof2-sec-title">Allergies & intolÃ©rances</div>
        <div class="prof2-card">
          <div class="prof2-allergy-grid" id="prof-allergy-grid">
            <div class="prof2-allergy-chip" data-allergy="Arachides">ğŸ¥œ Arachides</div>
            <div class="prof2-allergy-chip" data-allergy="Lactose">ğŸ¥› Lactose</div>
            <div class="prof2-allergy-chip" data-allergy="Gluten">ğŸŒ¾ Gluten</div>
            <div class="prof2-allergy-chip" data-allergy="CrustacÃ©s">ğŸ¦ CrustacÃ©s</div>
            <div class="prof2-allergy-chip" data-allergy="Oeufs">ğŸ¥š Oeufs</div>
            <div class="prof2-allergy-chip" data-allergy="Poisson">ğŸŸ Poisson</div>
            <div class="prof2-allergy-chip" data-allergy="Noix">ğŸŒ° Noix</div>
            <div class="prof2-allergy-chip" data-allergy="Soja">ğŸ«˜ Soja</div>
          </div>
        </div>
      </div>

      <!-- Aliments non aimÃ©s -->
      <div class="prof2-sec">
        <div class="prof2-sec-title">Aliments non aimÃ©s</div>
        <div class="prof2-card">
          <div class="prof2-dislike-wrap" id="prof-dislike-tags"></div>
          <div class="prof2-dislike-inp-row">
            <input class="prof2-dislike-inp" id="prof-dislike-inp" type="text" placeholder="Ex: coriandre, anchoisâ€¦" maxlength="30">
            <button class="prof2-dislike-add" id="prof-dislike-add">+</button>
          </div>
        </div>
      </div>

      <!-- ParamÃ¨tres -->
      <div class="prof2-sec">
        <div class="prof2-sec-title">ParamÃ¨tres</div>
        <div class="prof2-card">
          <div class="prof2-row" id="prof-tog-notif" style="cursor:pointer;">
            <span class="prof2-row-ic">ğŸ””</span>
            <span class="prof2-row-lbl">Notifications</span>
            <div class="toggle on" id="tog-notif"></div>
          </div>
          <div class="prof2-row" id="prof-tog-dark" style="cursor:pointer;">
            <span class="prof2-row-ic">ğŸŒ™</span>
            <span class="prof2-row-lbl">Mode sombre</span>
            <div class="toggle" id="tog-dark"></div>
          </div>
        </div>
      </div>

      <!-- Danger zone -->
      <div class="prof2-sec">
        <div class="prof2-card">
          <div class="prof2-row" id="btn-prof-logout" style="cursor:pointer;">
            <span class="prof2-row-ic">ğŸšª</span>
            <span class="prof2-row-lbl prof2-danger">Se dÃ©connecter</span>
          </div>
        </div>
      </div>

    </div>
  </div>

</div><!-- /phone -->

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script data-cfasync="false">
(function(){"use strict";

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RECIPES DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var RECIPES=[
{id:0,emoji:"ğŸ§€",title:"Gratin de Ravioles du DauphinÃ©",
desc:"Ravioles du DauphinÃ© IGP gratinÃ©es Ã  la crÃ¨me entiÃ¨re et au gruyÃ¨re, simplement poivrÃ©es.",
tag1:"PASTA",tag2:"VÃ‰GÃ‰TARIEN",time:"30 min",grad:"linear-gradient(135deg,#F6D365,#FDA085)",
ing:[
  ["Ravioles du DauphinÃ© IGP surgelÃ©es","500g"],
  ["CrÃ¨me liquide entiÃ¨re","650ml"],
  ["GruyÃ¨re rÃ¢pÃ©","100g"],
  ["Poivre","Ã  goÃ»t"]
],
steps:[
  "PrÃ©chauffer le four Ã  210Â°C.",
  "Verser les ravioles surgelÃ©es dÃ©tachÃ©es dans un plat Ã  gratin sans les dÃ©congeler.",
  "Ajouter la crÃ¨me liquide, poivrer selon votre goÃ»t et parsemer de gruyÃ¨re rÃ¢pÃ©.",
  "Enfourner 25 minutes jusquâ€™Ã  ce que le dessus soit bien dorÃ©.",
  "Servir immÃ©diatement, accompagnÃ© dâ€™une salade verte."
]},
  {id:1,emoji:"ğŸ¥—",title:"Salade NiÃ§oise",desc:"La salade emblÃ©matique de Nice : thon, anchois, olives, oeufs et tomates.",tag1:"SALADE",tag2:"TRADITIONNEL",time:"15 min",grad:"linear-gradient(135deg,#a8e6cf,#56ab2f)",
   ing:[["Thon en boÃ®te","160g"],["Oeufs","2"],["Tomates","3"],["Olives noires","50g"],["Anchois","6 filets"],["Haricots verts","100g"]],
   steps:["Cuire les oeufs 9 min, refroidir et couper en quartiers.","Blanchir les haricots verts 5 min, refroidir.","Disposer tous les ingrÃ©dients sur un lit de salade.","Assaisonner d'huile d'olive, vinaigre, sel et poivre."]},
  {id:2,emoji:"ğŸ²",title:"Curry de Lentilles",desc:"Curry rouge doux aux lentilles corail, Ã©pinards frais et lait de coco.",tag1:"VEGAN",tag2:"Ã‰PICÃ‰",time:"35 min",grad:"linear-gradient(135deg,#f6d365,#fda085)",
   ing:[["Lentilles corail","200g"],["Lait de coco","40cl"],["Ã‰pinards","100g"],["Curry rouge","2 c.s."],["Oignon","1"],["Ail","3 gousses"]],
   steps:["Faire revenir l'oignon et l'ail 3 min.","Ajouter le curry puis les lentilles rincÃ©es.","Verser le lait de coco et 20cl d'eau, cuire 20 min.","Incorporer les Ã©pinards hors feu, assaisonner."]},
  {id:3,emoji:"ğŸ£",title:"Bowl Saumon Avocat",desc:"Riz vinaigrÃ©, saumon marinÃ©, avocat et concombre en julienne.",tag1:"BOWL",tag2:"JAPONAIS",time:"20 min",grad:"linear-gradient(135deg,#89f7fe,#66a6ff)",
   ing:[["Saumon frais","200g"],["Riz sushi","150g"],["Avocat","1"],["Concombre","Â½"],["Sauce soja","3 c.s."],["Graines de sÃ©same","1 c.s."]],
   steps:["Cuire le riz et assaisonner de vinaigre de riz sucrÃ©.","Couper le saumon en dÃ©s, mariner 10 min dans la sauce soja.","Trancher l'avocat et le concombre finement.","Dresser le riz en base, disposer les garnitures."]},
  {id:4,emoji:"ğŸ¥˜",title:"Ratatouille ProvenÃ§ale",desc:"LÃ©gumes du soleil mijotÃ©s Ã  l'huile d'olive avec thym et basilic frais.",tag1:"VÃ‰GÃ‰TARIEN",tag2:"FRANÃ‡AIS",time:"50 min",grad:"linear-gradient(135deg,#d4fc79,#96e6a1)",
   ing:[["Courgettes","2"],["Aubergines","1"],["Poivrons","2"],["Tomates","4"],["Thym","1 bouquet"],["Huile d'olive","5 c.s."]],
   steps:["Couper tous les legumes en rondelles de 5 mm.","Faire revenir sÃ©parÃ©ment chaque lÃ©gume.","Assembler dans une cocotte avec les tomates et le thym.","Mijoter 30 min Ã  feu doux."]},
  {id:5,emoji:"ğŸ°",title:"Tarte Tatin aux Pommes",desc:"Tarte renversÃ©e caramÃ©lisÃ©e aux pommes golden, pÃ¢te feuilletÃ©e croustillante.",tag1:"DESSERT",tag2:"CLASSIQUE",time:"55 min",grad:"linear-gradient(135deg,#fccb90,#d57eeb)",
   ing:[["Pommes Golden","6"],["Beurre","60g"],["Sucre","120g"],["PÃ¢te feuilletÃ©e","1 rouleau"],["Cannelle","1 c.c."]],
   steps:["Faire un caramel brun avec beurre et sucre.","Disposer les pommes pelÃ©es sur le caramel chaud.","Couvrir de pÃ¢te feuilletÃ©e en rentrant les bords.","Cuire 25 min Ã  200Â°C. Retourner immÃ©diatement."]},
  {id:6,emoji:"ğŸ¥©",title:"EntrecÃ´te CafÃ© de Paris",desc:"EntrecÃ´te grillÃ©e, sauce beurre composÃ© aux herbes et cÃ¢pres.",tag1:"VIANDE",tag2:"BRASSERIE",time:"20 min",grad:"linear-gradient(135deg,#f43b47,#453a94)",
   ing:[["EntrecÃ´te","350g"],["Beurre","80g"],["CÃ¢pres","1 c.s."],["Estragon","Â½ bouquet"],["Moutarde","1 c.c."]],
   steps:["Sortir la viande 30 min avant cuisson.","PrÃ©parer le beurre cafÃ© de Paris en mixant beurre mou et aromates.","Saisir l'entrecÃ´te 2 min de chaque cÃ´tÃ© Ã  feu trÃ¨s vif.","Laisser reposer 3 min, dresser avec une noix de beurre."]},
  {id:7,emoji:"ğŸ«•",title:"Tajine d'Agneau",desc:"Agneau confit aux pruneaux, amandes grillÃ©es, Ã©pices marocaines et miel.",tag1:"MIJOTE",tag2:"MAROCAIN",time:"80 min",grad:"linear-gradient(135deg,#c79081,#dfa579)",
   ing:[["Ã‰paule d'agneau","700g"],["Pruneaux","150g"],["Amandes","50g"],["Ras el-hanout","2 c.s."],["Miel","2 c.s."]],
   steps:["Faire dorer les morceaux d'agneau sur toutes faces.","Ajouter les oignons, les Ã©pices, couvrir d'eau.","Mijoter 1h avec les pruneaux et le miel.","Parsemer d'amandes grillÃ©es, servir avec semoule."]},
  {id:8,emoji:"ğŸœ",title:"Ramen Miso Shiitake",desc:"Bouillon riche miso, nouilles fraÃ®ches, shiitakes sautÃ©s, oeuf mollet marinÃ©.",tag1:"SOUPE",tag2:"JAPONAIS",time:"40 min",grad:"linear-gradient(135deg,#e0c3fc,#8ec5fc)",
   ing:[["PÃ¢tes ramen","200g"],["Miso blanc","3 c.s."],["Shiitakes","100g"],["Oeufs","2"],["Ciboule","3 tiges"]],
   steps:["Cuire les oeufs 6.5 min, les mariner dans soja sucrÃ©.","Faire revenir les shiitakes Ã  l'huile de sÃ©same.","Dissoudre le miso dans 800 ml de bouillon dashi chaud.","Cuire les nouilles, dresser dans le bouillon."]},
  {id:9,emoji:"ğŸ¥",title:"CrÃªpes Suzette",desc:"CrÃªpes fines flambÃ©es au Grand Marnier, sauce orange caramÃ©lisÃ©e.",tag1:"DESSERT",tag2:"FRANÃ‡AIS",time:"30 min",grad:"linear-gradient(135deg,#FFA07A,#FF6347)",
   ing:[["Farine","150g"],["Oeufs","3"],["Lait","350ml"],["Beurre","50g"],["Grand Marnier","5cl"],["Orange","2"]],
   steps:["PrÃ©parer la pÃ¢te Ã  crÃªpes, laisser reposer 30 min.","Cuire les crÃªpes fines dans une poÃªle beurrÃ©e.","PrÃ©parer la sauce : jus d'orange, zestes, beurre, sucre, rÃ©duire 5 min.","Plier les crÃªpes en 4, flamber au Grand Marnier."]},
  {id:10,emoji:"ğŸ•",title:"Pizza Bianca Burrata",desc:"Pizza crÃ¨me fraÃ®che, burrata fondante, roquette et jambon de Parme.",tag1:"PIZZA",tag2:"ITALIEN",time:"35 min",grad:"linear-gradient(135deg,#f5f5f5,#c9d6ff)",
   ing:[["PÃ¢te Ã  pizza","1"],["CrÃ¨me fraÃ®che","15cl"],["Burrata","125g"],["Jambon de Parme","60g"],["Roquette","40g"]],
   steps:["Ã‰taler la pÃ¢te finement sur plaque farinÃ©e.","Napper de crÃ¨me fraÃ®che, enfourner 12 min Ã  240Â°C.","DÃ©poser la burrata dÃ©chirÃ©e sur la pizza chaude.","Ajouter le jambon, la roquette et du parmesan."]},
  {id:11,emoji:"ğŸ¥‘",title:"Toast Avocat Burrata",desc:"Pain grillÃ©, avocat citronnÃ©, burrata, dukkah et menthe fraÃ®che.",tag1:"BRUNCH",tag2:"VEGGIE",time:"10 min",grad:"linear-gradient(135deg,#84fab0,#8fd3f4)",
   ing:[["Pain de campagne","2 tranches"],["Avocat","1"],["Burrata","1"],["Dukkah","1 c.s."],["Citron","Â½"]],
   steps:["Griller le pain jusqu'Ã  dorure.","Ã‰craser l'avocat avec jus de citron, sel et poivre.","Tartiner le pain d'avocat, dÃ©poser la burrata dÃ©chirÃ©e.","Parsemer de dukkah et dÃ©corer de feuilles de menthe."]},
  {id:12,emoji:"ğŸ¦",title:"Gambas Plancha",desc:"Gambas royales grillÃ©es, sauce chimichurri herbacÃ©e et citron vert.",tag1:"POISSON",tag2:"ARGENTIN",time:"15 min",grad:"linear-gradient(135deg,#f093fb,#f5576c)",
   ing:[["Gambas royales","12"],["Persil plat","1 bouquet"],["Ail","4 gousses"],["Huile d'olive","8 c.s."],["Piment","1"],["Citron vert","2"]],
   steps:["Mixer persil, ail, piment, vinaigre et huile â€” chimichurri prÃªt.","Inciser les gambas, arroser d'huile et ail.","Cuire 2 min de chaque cÃ´tÃ© sur plancha trÃ¨s chaude.","Napper de chimichurri, servir avec citron vert."]},
  {id:13,emoji:"ğŸ¥Ÿ",title:"Tortellini Ã‰pinard CrÃ¨me",desc:"Tortellini fondants, Ã©pinards sautÃ©s et sauce crÃ¨me au gruyÃ¨re.",tag1:"VÃ‰GÃ‰TARIEN",tag2:"RAPIDE",time:"25 min",grad:"linear-gradient(135deg,#84fab0,#8fd3f4)",
   ing:[["Tortellini fromage","500 g"],["Ã‰pinards frais","300 g"],["CrÃ¨me fraÃ®che","20 cl"],["GruyÃ¨re rÃ¢pÃ©","100 g"],["Ail","1 gousse"],["Huile d'olive","1 c.s."],["Sel","Au goÃ»t"],["Poivre","Au goÃ»t"]],
   steps:["Cuire les tortellini dans une grande eau salÃ©e puis Ã©goutter.","Faire revenir l'ail dans l'huile, ajouter les Ã©pinards et laisser tomber.","Incorporer la crÃ¨me, saler, poivrer et laisser mijoter 3 Ã  5 min.","Ajouter les tortellini, mÃ©langer dÃ©licatement puis incorporer le gruyÃ¨re jusqu'Ã  fonte complÃ¨te."]},
  {id:14,emoji:"ğŸŒ¶ï¸",title:"Chili Con Carne Rapide",desc:"Viande hachÃ©e, haricots rouges et tomates, relevÃ©s d'Ã©pices, prÃªt en moins de 30 min.",tag1:"Ã‰PICÃ‰",tag2:"RAPIDE",time:"30 min",grad:"linear-gradient(135deg,#f6d365,#fda085)",
   ing:[["Viande hachÃ©e de boeuf","500 g"],["Haricots rouges en conserve","400 g"],["Tomates concassÃ©es en conserve","400 g"],["Oignon","1"],["Ail","2 gousses"],["Piment en poudre","1 c.c."],["Cumin en poudre","1 c.c."],["Huile d'olive","2 c.s."],["Sel","Au goÃ»t"],["Poivre","Au goÃ»t"]],
   steps:["Emincer l'oignon et hacher l'ail.","Faire revenir l'oignon et l'ail dans l'huile chaude.","Ajouter la viande hachÃ©e et cuire jusqu'a dorure.","Ajouter tomates, haricots, piment et cumin, saler et poivrer.","Laisser mijoter 10 a 15 min, servir chaud."]},
  {id:15,emoji:"ğŸ¥ª",title:"Croc Monsieur Salade Chevre",desc:"Croque-monsieur dore au jambon et fromage, salade verte et chevre chaud.",tag1:"RAPIDE",tag2:"CLASSIQUE",time:"15 min",grad:"linear-gradient(135deg,#fceabb,#f8b500)",
   ing:[["Pain de mie","8 tranches"],["Jambon","4 tranches"],["Fromage rape","100 g"],["Beurre","20 g"],["Salade verte","150 g"],["Chevre","100 g"],["Miel","1 c.c."],["Huile d'olive","1 c.s."],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Prechauffer le four a 200 C.","Preparer les croques avec beurre, jambon et fromage, enfourner 10 min.","Couper le chevre en rondelles, dorer au four.","Assaisonner la salade, servir avec les croques et le chevre chaud."]},
  {id:16,emoji:"ğŸŒ­",title:"Saucisses et Lentilles",desc:"Saucisses dorees servies sur un lit de lentilles mijotees aux aromates.",tag1:"RAPIDE",tag2:"CLASSIQUE",time:"25 min",grad:"linear-gradient(135deg,#d4fc79,#96e6a1)",
   ing:[["Saucisses","4"],["Lentilles vertes","200 g"],["Carotte","1"],["Oignon","1"],["Ail","1 gousse"],["Bouillon de legumes","400 ml"],["Huile d'olive","1 c.s."],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Emincer oignon, carotte et hacher l'ail.","Faire revenir les saucisses a la poele jusqu'a dorure, reserver.","Faire revenir les legumes dans la meme poele, ajouter les lentilles et le bouillon.","Cuire 15 min jusqu'a tendrete, assaisonner.","Servir les lentilles avec les saucisses dorees par-dessus."]}
,
  {id:17,emoji:"ğŸ",title:"Spaghetti Bolognaise",desc:"Spaghetti avec sauce tomate et viande hachee parfumee aux herbes.",tag1:"RAPIDE",tag2:"CLASSIQUE",time:"25 min",grad:"linear-gradient(135deg,#f093fb,#f5576c)",
   ing:[["Spaghetti","250 g"],["Viande hachee","300 g"],["Tomates concassees","400 g"],["Oignon","1"],["Ail","1 gousse"],["Huile d'olive","1 c.s."],["Sel","Au gout"],["Poivre","Au gout"],["Herbes de Provence","1 c.c."]],
   steps:["Faire revenir l'oignon et l'ail haches dans l'huile.","Ajouter la viande et cuire jusqu'a dorure.","Incorporer les tomates et herbes, laisser mijoter 15 min.","Cuire les spaghetti, servir avec la sauce."]},
  {id:18,emoji:"ğŸ¥—",title:"Salade Cesar Rapide",desc:"Salade croquante avec poulet grille, croutons et sauce Cesar.",tag1:"RAPIDE",tag2:"FRAIS",time:"15 min",grad:"linear-gradient(135deg,#f6d365,#fda085)",
   ing:[["Laitue romaine","150 g"],["Poulet grille","200 g"],["Croutons","50 g"],["Parmesan rape","30 g"],["Sauce Cesar","2 c.s."],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Couper la laitue et le poulet.","Melanger avec croutons et parmesan.","Ajouter la sauce et servir."]},
  {id:19,emoji:"ğŸ›",title:"Curry de Poulet Express",desc:"Poulet mijote dans une sauce curry cremeuse avec legumes.",tag1:"RAPIDE",tag2:"EPICE",time:"25 min",grad:"linear-gradient(135deg,#ffecd2,#fcb69f)",
   ing:[["Poulet en morceaux","300 g"],["Lait de coco","200 ml"],["Curry en poudre","1 c.c."],["Carotte","1"],["Poivron","1"],["Oignon","1"],["Huile","1 c.s."],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Faire revenir l'oignon et legumes dans l'huile.","Ajouter le poulet et le curry, cuire 5 min.","Incorporer le lait de coco, mijoter 15 min."]},
  {id:20,emoji:"ğŸ²",title:"Soupe de Legumes",desc:"Soupe rapide aux legumes varies et herbes aromatiques.",tag1:"RAPIDE",tag2:"VEGETARIEN",time:"20 min",grad:"linear-gradient(135deg,#cfd9df,#e2ebf0)",
   ing:[["Carotte","1"],["Courgette","1"],["Pommes de terre","1"],["Oignon","1"],["Bouillon de legumes","500 ml"],["Sel","Au gout"],["Poivre","Au gout"],["Herbes fraiches","1 c.s."]],
   steps:["Emincer tous les legumes.","Les cuire dans le bouillon 15 min.","Assaisonner et servir chaud."]},
  {id:21,emoji:"ğŸš",title:"Risotto CrÃ©meux aux Champignons",desc:"Risotto italien onctueux au parmesan et champignons sautÃ©s.",tag1:"ITALIEN",tag2:"CRÃ‰MEUX",time:"30 min",grad:"linear-gradient(135deg,#d4fc79,#96e6a1)",
   ing:[["Riz arborio","200g"],["Champignons de Paris","250g"],["Bouillon de lÃ©gumes","1 L"],["Parmesan rÃ¢pÃ©","60g"],["Oignon","1"],["Beurre","30g"],["Vin blanc","10 cl"],["Huile d'olive","1 c.s."],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Chauffer le bouillon dans une casserole et maintenir frÃ©missant.","Faire revenir l'oignon Ã©mincÃ© dans l'huile d'olive et la moitiÃ© du beurre.","Ajouter le riz et nacrer 2 minutes.","DÃ©glacer avec le vin blanc et laisser Ã©vaporer.",
   "Incorporer le bouillon chaud louche par louche en remuant jusqu'Ã  absorption.","Ajouter les champignons sautÃ©s Ã  mi-cuisson.","Hors du feu incorporer le reste du beurre et le parmesan.","Assaisonner et servir immÃ©diatement."]},
  {id:22,emoji:"ğŸ¥˜",title:"Ratatouille Express",desc:"Melange de legumes mijotes parfumes aux herbes.",tag1:"VEGETARIEN",tag2:"RAPIDE",time:"20 min",grad:"linear-gradient(135deg,#84fab0,#8fd3f4)",
   ing:[["Courgette","1"],["Aubergine","1"],["Poivron","1"],["Tomate","2"],["Oignon","1"],["Ail","1 gousse"],["Huile d'olive","1 c.s."],["Herbes de Provence","1 c.c."],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Emincer tous les legumes.","Faire revenir l'oignon et l'ail.","Ajouter les legumes et herbes, cuire 15 min a couvert."]},
  {id:23,emoji:"ğŸŒ®",title:"Tacos Rapides",desc:"Tortillas garnies de viande, legumes et fromage, prets en 15 min.",tag1:"RAPIDE",tag2:"FAMILIAL",time:"15 min",grad:"linear-gradient(135deg,#ffecd2,#fcb69f)",
   ing:[["Tortillas","4"],["Viande hachee","250 g"],["Laitue","50 g"],["Tomate","1"],["Fromage rape","50 g"],["Huile","1 c.s."],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Cuire la viande dans l'huile.","Garnir les tortillas avec viande, legumes et fromage.","Servir immediatement."]},
  {id:24,emoji:"ğŸ³",title:"Omelette Fromage",desc:"Omelette rapide au fromage fondant.",tag1:"RAPIDE",tag2:"VEGETARIEN",time:"10 min",grad:"linear-gradient(135deg,#fceabb,#f8b500)",
   ing:[["Oeufs","3"],["Fromage rape","50 g"],["Beurre","10 g"],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Battre les oeufs avec sel et poivre.","Cuire dans le beurre chaud.","Ajouter le fromage, plier et servir."]},
  {id:25,emoji:"ğŸ¥™",title:"Wrap Poulet Legumes",desc:"Wrap garni de poulet grille et legumes frais.",tag1:"RAPIDE",tag2:"FRAIS",time:"15 min",grad:"linear-gradient(135deg,#f6d365,#fda085)",
   ing:[["Tortilla","2"],["Poulet grille","150 g"],["Laitue","50 g"],["Tomate","1"],["Mayonnaise","1 c.s."],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Couper poulet et legumes.","Garnir les tortillas avec tous les ingredients.","Rouler et servir."]},
  {id:26,emoji:"ğŸ¥”",title:"Pommes de Terre Sautees",desc:"Pommes de terre dorees et croustillantes a l'huile d'olive.",tag1:"RAPIDE",tag2:"CLASSIQUE",time:"20 min",grad:"linear-gradient(135deg,#cfd9df,#e2ebf0)",
   ing:[["Pommes de terre","500 g"],["Huile d'olive","2 c.s."],["Sel","Au gout"],["Poivre","Au gout"],["Herbes de Provence","1 c.c."]],
   steps:["Eplucher et couper les pommes de terre.","Les faire revenir dans l'huile jusqu'a dorure.","Assaisonner et servir."]},
  {id:27,emoji:"ğŸ¥ª",title:"Sandwich Thon Salade",desc:"Sandwich rapide au thon, mayonnaise et salade croquante.",tag1:"RAPIDE",tag2:"FRAIS",time:"10 min",grad:"linear-gradient(135deg,#84fab0,#8fd3f4)",
   ing:[["Pain","2 tranches"],["Thon en boite","100 g"],["Mayonnaise","1 c.s."],["Salade","30 g"],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Melanger thon et mayonnaise.","Garnir le pain avec thon et salade.","Servir immediatement."]},
  {id:28,emoji:"ğŸ¥©",title:"Steak et Puree",desc:"Steak grille accompagne de puree onctueuse.",tag1:"CLASSIQUE",tag2:"RAPIDE",time:"20 min",grad:"linear-gradient(135deg,#f093fb,#f5576c)",
   ing:[["Steak","2"],["Pommes de terre","300 g"],["Beurre","20 g"],["Lait","50 ml"],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Cuire le steak a la poele.","Cuire les pommes de terre, ecraser avec beurre et lait.","Servir le steak avec la puree."]},
  {id:29,emoji:"ğŸ•",title:"Pizza Maison Express",desc:"Mini pizza rapide avec sauce tomate et fromage.",tag1:"RAPIDE",tag2:"FAMILIAL",time:"20 min",grad:"linear-gradient(135deg,#ffecd2,#fcb69f)",
   ing:[["Pate a pizza","1"],["Sauce tomate","50 g"],["Fromage rape","50 g"],["Jambon","2 tranches"],["Olives","6"],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Etaler la sauce sur la pate.","Ajouter fromage et garnitures.","Cuire 10-12 min au four a 200 C."]},
  {id:30,emoji:"ğŸ¤",title:"Crevettes Sautees",desc:"Crevettes dorees a l'ail et huile d'olive.",tag1:"RAPIDE",tag2:"EPICE",time:"15 min",grad:"linear-gradient(135deg,#f6d365,#fda085)",
   ing:[["Crevettes decortiquees","200 g"],["Ail","1 gousse"],["Huile d'olive","1 c.s."],["Sel","Au gout"],["Poivre","Au gout"],["Piment","1 pincee"]],
   steps:["Faire revenir l'ail dans l'huile.","Ajouter les crevettes et cuire 3-5 min.","Assaisonner et servir."]},
  {id:31,emoji:"ğŸ¥—",title:"Taboule Express",desc:"Salade fraiche de semoule, tomates et herbes.",tag1:"RAPIDE",tag2:"VEGETARIEN",time:"10 min",grad:"linear-gradient(135deg,#84fab0,#8fd3f4)",
   ing:[["Semoule","100 g"],["Tomates","2"],["Concombre","0.5"],["Persil","1 bouquet"],["Menthe","1 c.s."],["Citron","1"],["Huile d'olive","1 c.s."],["Sel","Au gout"]],
   steps:["Cuire la semoule, laisser refroidir.","Couper legumes et herbes.","Melanger avec semoule, citron et huile."]},
  {id:32,emoji:"ğŸ¥©",title:"Boeuf Stroganoff Rapide",desc:"Boeuf saute a la creme et champignons, pret en 20 min.",tag1:"RAPIDE",tag2:"CLASSIQUE",time:"20 min",grad:"linear-gradient(135deg,#f093fb,#f5576c)",
   ing:[["Boeuf en lanieres","300 g"],["Champignons","150 g"],["Oignon","1"],["Creme fraiche","100 ml"],["Huile","1 c.s."],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Faire revenir oignon et champignons.","Ajouter le boeuf, cuire 5 min.","Incorporer creme, assaisonner et servir."]},
  {id:33,emoji:"ğŸ",title:"Pates au Pesto",desc:"Pates rapides avec sauce pesto et parmesan.",tag1:"RAPIDE",tag2:"VEGETARIEN",time:"15 min",grad:"linear-gradient(135deg,#f6d365,#fda085)",
   ing:[["Pates","250 g"],["Pesto","3 c.s."],["Parmesan rape","30 g"],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Cuire les pates, egoutter.","Melanger avec le pesto et parmesan.","Servir chaud."]},
  {id:34,emoji:"ğŸ¥©",title:"Hachis Parmentier Express",desc:"Hachis de viande et puree, pret en 25 min.",tag1:"RAPIDE",tag2:"CLASSIQUE",time:"25 min",grad:"linear-gradient(135deg,#cfd9df,#e2ebf0)",
   ing:[["Viande hachee","300 g"],["Pommes de terre","300 g"],["Beurre","20 g"],["Lait","50 ml"],["Oignon","1"],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Cuire les pommes de terre et preparer la puree.","Faire revenir la viande avec oignon.","Mettre viande au fond, puree dessus, gratiner 5 min."]},
  {id:35,emoji:"ğŸ”",title:"Burger Maison Rapide",desc:"Burger rapide avec steak, fromage et salade.",tag1:"RAPIDE",tag2:"FAMILIAL",time:"20 min",grad:"linear-gradient(135deg,#ffecd2,#fcb69f)",
   ing:[["Pain a burger","2"],["Steak hache","2"],["Fromage","2 tranches"],["Salade","30 g"],["Tomate","1"],["Mayonnaise","1 c.s."],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Cuire le steak a la poele.","Assembler le burger avec pain, steak, fromage, salade et tomate.","Servir immediatement."]},
  {id:36,emoji:"ğŸ¥—",title:"Salade Cesar Rapide",desc:"Salade croquante avec poulet grille, croutons et sauce Cesar.",tag1:"RAPIDE",tag2:"FRAIS",time:"15 min",grad:"linear-gradient(135deg,#f6d365,#fda085)",
   ing:[["Laitue romaine","150 g"],["Poulet grille","200 g"],["Croutons","50 g"],["Parmesan rape","30 g"],["Sauce Cesar","2 c.s."],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Couper la laitue et le poulet.","Melanger avec croutons et parmesan.","Ajouter la sauce et servir."]},
  {id:37,emoji:"ğŸ²",title:"Soupe de Legumes",desc:"Soupe rapide aux legumes varies et herbes aromatiques.",tag1:"RAPIDE",tag2:"VEGETARIEN",time:"20 min",grad:"linear-gradient(135deg,#cfd9df,#e2ebf0)",
   ing:[["Carotte","1"],["Courgette","1"],["Pommes de terre","1"],["Oignon","1"],["Bouillon de legumes","500 ml"],["Sel","Au gout"],["Poivre","Au gout"],["Herbes fraiches","1 c.s."]],
   steps:["Emincer tous les legumes.","Les cuire dans le bouillon 15 min.","Assaisonner et servir chaud."]},
  {id:38,emoji:"ğŸ—",title:"Poulet Roti Simple",desc:"Poulet roti au four avec herbes et huile d'olive.",tag1:"CLASSIQUE",tag2:"RAPIDE",time:"35 min",grad:"linear-gradient(135deg,#f6d365,#fda085)",
   ing:[["Poulet entier","1"],["Huile d'olive","2 c.s."],["Herbes de Provence","1 c.c."],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Prechauffer le four a 200 C.","Badigeonner le poulet d'huile et herbes.","Rotir 30 min jusqu'a dorure."]},
  {id:39,emoji:"ğŸ¥™",title:"Wrap Poulet Legumes",desc:"Wrap garni de poulet grille et legumes frais.",tag1:"RAPIDE",tag2:"FRAIS",time:"15 min",grad:"linear-gradient(135deg,#f6d365,#fda085)",
   ing:[["Tortilla","2"],["Poulet grille","150 g"],["Laitue","50 g"],["Tomate","1"],["Mayonnaise","1 c.s."],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Couper poulet et legumes.","Garnir les tortillas avec tous les ingredients.","Rouler et servir."]},
  {id:40,emoji:"ğŸ¥”",title:"Pommes de Terre Sautees",desc:"Pommes de terre dorees et croustillantes a l'huile d'olive.",tag1:"RAPIDE",tag2:"CLASSIQUE",time:"20 min",grad:"linear-gradient(135deg,#cfd9df,#e2ebf0)",
   ing:[["Pommes de terre","500 g"],["Huile d'olive","2 c.s."],["Sel","Au gout"],["Poivre","Au gout"],["Herbes de Provence","1 c.c."]],
   steps:["Eplucher et couper les pommes de terre.","Les faire revenir dans l'huile jusqu'a dorure.","Assaisonner et servir."]},
  {id:41,emoji:"ğŸ¥©",title:"Steak et Puree",desc:"Steak grille accompagne de puree onctueuse.",tag1:"CLASSIQUE",tag2:"RAPIDE",time:"20 min",grad:"linear-gradient(135deg,#f093fb,#f5576c)",
   ing:[["Steak","2"],["Pommes de terre","300 g"],["Beurre","20 g"],["Lait","50 ml"],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Cuire le steak a la poele.","Cuire les pommes de terre, ecraser avec beurre et lait.","Servir le steak avec la puree."]},
  {id:42,emoji:"ğŸ¤",title:"Crevettes Sautees",desc:"Crevettes dorees a l'ail et huile d'olive.",tag1:"RAPIDE",tag2:"EPICE",time:"15 min",grad:"linear-gradient(135deg,#f6d365,#fda085)",
   ing:[["Crevettes decortiquees","200 g"],["Ail","1 gousse"],["Huile d'olive","1 c.s."],["Sel","Au gout"],["Poivre","Au gout"],["Piment","1 pincee"]],
   steps:["Faire revenir l'ail dans l'huile.","Ajouter les crevettes et cuire 3-5 min.","Assaisonner et servir."]},
  {id:43,emoji:"ğŸ¥—",title:"Taboule Express",desc:"Salade fraiche de semoule, tomates et herbes.",tag1:"RAPIDE",tag2:"VEGETARIEN",time:"10 min",grad:"linear-gradient(135deg,#84fab0,#8fd3f4)",
   ing:[["Semoule","100 g"],["Tomates","2"],["Concombre","0.5"],["Persil","1 bouquet"],["Menthe","1 c.s."],["Citron","1"],["Huile d'olive","1 c.s."],["Sel","Au gout"]],
   steps:["Cuire la semoule, laisser refroidir.","Couper legumes et herbes.","Melanger avec semoule, citron et huile."]},
  {id:44,emoji:"ğŸ¥©",title:"Boeuf Stroganoff Rapide",desc:"Boeuf saute a la creme et champignons, pret en 20 min.",tag1:"RAPIDE",tag2:"CLASSIQUE",time:"20 min",grad:"linear-gradient(135deg,#f093fb,#f5576c)",
   ing:[["Boeuf en lanieres","300 g"],["Champignons","150 g"],["Oignon","1"],["Creme fraiche","100 ml"],["Huile","1 c.s."],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Faire revenir oignon et champignons.","Ajouter le boeuf, cuire 5 min.","Incorporer creme, assaisonner et servir."]},
   {id:45,emoji:"ğŸ¥—",title:"Salade de Riz au Thon",desc:"Salade fraÃ®che et rapide de riz avec thon, tomates cerises, mais et mayonnaise.",tag1:"SALADE",tag2:"RAPIDE",time:"15 min",grad:"linear-gradient(135deg,#a8e6cf,#56ab2f)",
   ing:[["Riz cuit","200g"],["Thon en boÃ®te","120g"],["Tomates cerises","150g"],["Mayonnaise","2 c.s."],["MÃ„IS","250g"],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Cuire le riz et laisser refroidir.","Couper les tomates cerises en deux.","MÃ©langer le riz, le thon Ã©miettÃ© et les tomates ainsi que le mÃ„is.","Ajouter la mayonnaise et assaisonner de sel et poivre.","Bien mÃ©langer et servir frais."]},
   {id:46,emoji:"ğŸ§€",title:"Tartiflette Savoyarde",desc:"Gratin de pommes de terre, lardons et reblochon crÃ©meux, plat traditionnel de Savoie.",tag1:"FRANÃ‡AIS",tag2:"CONFORT",time:"45 min",grad:"linear-gradient(135deg,#fceabb,#f8b500)",
   ing:[["Pommes de terre","600g"],["Lardons fumÃ©s","200g"],["Reblochon","250g"],["Oignon","1"],["CrÃ¨me fraÃ®che","10 cl"],["Beurre","20g"],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["PrÃ©chauffer le four Ã  200Â°C.","Ã‰plucher et couper les pommes de terre en rondelles, les prÃ©cuire 10 min Ã  l'eau bouillante.","Faire revenir l'oignon Ã©mincÃ© et les lardons dans une poÃªle.","Beurrer un plat Ã  gratin, disposer une couche de pommes de terre, ajouter les lardons et oignons, rÃ©pÃ©ter.","Verser la crÃ¨me fraÃ®che, recouvrir de reblochon coupÃ© en deux.","Enfourner 25 min jusqu'Ã  gratinage dorÃ© et servir chaud."]},
  {id:47,emoji:"ğŸ",title:"Pates au Pesto",desc:"Pates rapides avec sauce pesto et parmesan.",tag1:"RAPIDE",tag2:"VEGETARIEN",time:"15 min",grad:"linear-gradient(135deg,#f6d365,#fda085)",
   ing:[["Pates","250 g"],["Pesto","3 c.s."],["Parmesan rape","30 g"],["Sel","Au gout"],["Poivre","Au gout"]],
   steps:["Cuire les pates, egoutter.","Melanger avec le pesto et parmesan.","Servir chaud."]}
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CUSTOM RECIPES â€” user-created
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var CUSTOM_RECIPES = [];
var _customNextId = 10000; // offset to avoid clashing with built-in IDs

/* â”€â”€ Form state â”€â”€ */
var _cfState = {
  emoji: "ğŸ³",
  grad:  "linear-gradient(135deg,#FF6B6B,#FFE66D)",
  tags:  ["MAISON"],
  ingredients: [],   // [{name,qty}]
  photoDataUrl: null,
  editId: null       // null = new, number = editing
};

/* â”€â”€ Render the "Mes CrÃ©ations" screen â”€â”€ */
function renderCreateScreen(){
  var listEl = document.getElementById("cr-list-content");
  if(!listEl) return;
  listEl.innerHTML = "";

  if(CUSTOM_RECIPES.length === 0){
    var em = document.createElement("div");
    em.className = "cr-empty";
    em.innerHTML =
      "<div class='cr-empty-icon'>âœï¸</div>" +
      "<div class='cr-empty-title'>Pas encore de crÃ©ation</div>" +
      "<div class='cr-empty-sub'>Appuyez sur <b>+ Nouvelle</b> pour crÃ©er votre premiÃ¨re recette.<br>Elle apparaÃ®tra dans le swipe !</div>";
    listEl.appendChild(em);
    return;
  }

  var card = document.createElement("div");
  card.className = "cr-list cf-card";
  CUSTOM_RECIPES.forEach(function(r){
    var row = document.createElement("div");
    row.className = "cr-recipe-row";
    row.innerHTML =
      "<div class='cr-recipe-emoji' style='background:"+r.grad+";'>" + r.emoji + "</div>" +
      "<div class='cr-recipe-info'>" +
        "<div class='cr-recipe-title'>" + r.title + "</div>" +
        "<div class='cr-recipe-meta'>" + r.tag1 + (r.tag2 ? " Â· " + r.tag2 : "") + " Â· " + r.time + "</div>" +
      "</div>" +
      "<button class='cr-recipe-del' data-del='"+r.id+"'>âœ•</button>";

    // Tap row â†’ detail view
    row.addEventListener("click", function(e){
      if(e.target.closest(".cr-recipe-del")) return;
      openDetail(r.id, "create");
    });
    // Delete button
    row.querySelector(".cr-recipe-del").addEventListener("click", function(e){
      e.stopPropagation();
      deleteCustomRecipe(r.id);
    });
    card.appendChild(row);
  });
  listEl.appendChild(card);
}

/* â”€â”€ Switch tabs â”€â”€ */
function switchCreateTab(tab){
  var listPanel = document.getElementById("cr-panel-list");
  var formPanel = document.getElementById("cr-panel-form");
  var tabList  = document.getElementById("cr-tab-list");
  var tabForm  = document.getElementById("cr-tab-form");
  if(tab === "list"){
    listPanel.style.display = ""; formPanel.style.display = "none";
    tabList.classList.add("active"); tabForm.classList.remove("active");
    renderCreateScreen();
  } else {
    listPanel.style.display = "none"; formPanel.style.display = "";
    tabList.classList.remove("active"); tabForm.classList.add("active");
  }
}

/* â”€â”€ Build an ingredient row â”€â”€ */
function buildIngRow(ing, index){
  var row = document.createElement("div");
  row.className = "cf-ing-item";
  row.setAttribute("data-idx", index);
  var nameInp = document.createElement("input");
  nameInp.className = "cf-ing-name"; nameInp.type="text";
  nameInp.placeholder = "IngrÃ©dient"; nameInp.value = ing.name||"";
  nameInp.addEventListener("input", function(){ _cfState.ingredients[index].name = this.value; });
  var qtyInp = document.createElement("input");
  qtyInp.className = "cf-ing-qty"; qtyInp.type="text";
  qtyInp.placeholder = "QtÃ©"; qtyInp.value = ing.qty||"";
  qtyInp.addEventListener("input", function(){ _cfState.ingredients[index].qty = this.value; });
  var del = document.createElement("button");
  del.className = "cf-ing-del"; del.textContent = "âˆ’";
  del.addEventListener("click", function(){
    _cfState.ingredients.splice(index, 1);
    refreshIngList();
  });
  row.appendChild(nameInp); row.appendChild(qtyInp); row.appendChild(del);
  return row;
}

function refreshIngList(){
  var list = document.getElementById("cf-ing-list");
  if(!list) return;
  list.innerHTML = "";
  _cfState.ingredients.forEach(function(ing, i){
    list.appendChild(buildIngRow(ing, i));
  });
}

/* â”€â”€ Add an ingredient slot â”€â”€ */
function addIngSlot(){
  _cfState.ingredients.push({name:"", qty:""});
  refreshIngList();
  // Focus last name input
  var inputs = document.querySelectorAll(".cf-ing-name");
  if(inputs.length) inputs[inputs.length-1].focus();
}

/* â”€â”€ Delete custom recipe â”€â”€ */
function deleteCustomRecipe(id){
  var idx = CUSTOM_RECIPES.findIndex(function(r){ return r.id === id; });
  if(idx === -1) return;
  // Remove from planning too
  Object.keys(state.weekPlanning).forEach(function(k){
    if(state.weekPlanning[k] === id) delete state.weekPlanning[k];
  });
  // Remove from liked
  var li = state.likedIds.indexOf(id);
  if(li !== -1) state.likedIds.splice(li, 1);
  CUSTOM_RECIPES.splice(idx, 1);
  updateBadges(false);
  renderCreateScreen();
  toast("Recette supprimÃ©e");
}

/* â”€â”€ Reset form â”€â”€ */
function resetCreateForm(){
  _cfState.emoji = "ğŸ³";
  _cfState.grad  = "linear-gradient(135deg,#FF6B6B,#FFE66D)";
  _cfState.tags  = ["MAISON"];
  _cfState.ingredients = [];
  _cfState.photoDataUrl = null;
  _cfState.editId = null;

  var t = document.getElementById("cf-title"); if(t) t.value="";
  var d = document.getElementById("cf-desc");  if(d) d.value="";
  var ti = document.getElementById("cf-time"); if(ti) ti.value="";
  var po = document.getElementById("cf-portions"); if(po) po.value="";
  var pe = document.getElementById("cf-persons"); if(pe) pe.value="";
  var st = document.getElementById("cf-steps"); if(st) st.value="";

  // Photo zone
  var pz = document.getElementById("cf-photo-zone");
  if(pz){ pz.innerHTML="<div class='cf-photo-icon'>ğŸ“·</div><div class='cf-photo-lbl'>Ajouter une photo (optionnel)</div><input type='file' id='cf-photo-input' accept='image/*' style='display:none;'>"; pz.classList.remove("filled"); bindPhotoInput(); }

  // Emoji picker
  document.querySelectorAll(".cf-emoji-btn").forEach(function(b){
    b.classList.toggle("sel", b.getAttribute("data-emoji") === "ğŸ³");
  });

  // Gradient picker
  document.querySelectorAll(".cf-swatch").forEach(function(s, i){
    s.classList.toggle("sel", i === 0);
  });

  // Tags
  document.querySelectorAll("#cf-tags-preset .cf-tag").forEach(function(t){
    t.classList.toggle("sel", t.getAttribute("data-tag") === "MAISON");
  });

  refreshIngList();
}

/* â”€â”€ Bind photo input â”€â”€ */
function bindPhotoInput(){
  var pz = document.getElementById("cf-photo-zone");
  var pi = document.getElementById("cf-photo-input");
  if(!pz || !pi) return;
  pz.addEventListener("click", function(e){
    if(e.target === pi) return;
    pi.click();
  });
  pi.addEventListener("change", function(){
    var file = pi.files[0];
    if(!file) return;
    var reader = new FileReader();
    reader.onload = function(ev){
      _cfState.photoDataUrl = ev.target.result;
      pz.classList.add("filled");
      pz.innerHTML =
        "<img src='" + ev.target.result + "' alt='photo'>" +
        "<div class='cf-photo-overlay'><button class='cf-photo-change' id='cf-photo-change'>Changer</button></div>" +
        "<input type='file' id='cf-photo-input' accept='image/*' style='display:none;'>";
      bindPhotoInput();
    };
    reader.readAsDataURL(file);
  });
}

/* â”€â”€ Save recipe â”€â”€ */
function saveCustomRecipe(){
  var title = (document.getElementById("cf-title")||{}).value||"";
  if(!title.trim()){ toast("Donne un titre Ã  ta recette !"); return; }

  var desc  = (document.getElementById("cf-desc")||{}).value||"";
  var time  = (document.getElementById("cf-time")||{}).value||"30 min";
  var portions = parseInt((document.getElementById("cf-portions")||{}).value)||2;
  var stepsRaw = (document.getElementById("cf-steps")||{}).value||"";

  // Build steps array from textarea (one per line, skip blanks)
  var steps = stepsRaw.split("\n").map(function(s){return s.trim();}).filter(Boolean);
  if(!steps.length) steps = ["PrÃ©parer selon votre recette."];

  // Build ing array (filter empty rows)
  var ing = _cfState.ingredients.filter(function(i){return i.name.trim();}).map(function(i){
    return [i.name.trim(), i.qty.trim()||""];
  });

  // Pick up to 2 tags
  var t1 = _cfState.tags[0]||"MAISON";
  var t2 = _cfState.tags[1]||"";

  var id = (_cfState.editId !== null) ? _cfState.editId : _customNextId++;

  var recipe = {
    id:     id,
    emoji:  _cfState.emoji,
    title:  title.trim(),
    desc:   desc.trim() || "Recette maison.",
    tag1:   t1,
    tag2:   t2,
    time:   time.trim(),
    grad:   _cfState.grad,
    ing:    ing,
    steps:  steps,
    portions: portions,
    custom: true,
    photoUrl: _cfState.photoDataUrl || null
  };

  if(_cfState.editId !== null){
    var idx = CUSTOM_RECIPES.findIndex(function(r){return r.id===id;});
    if(idx !== -1) CUSTOM_RECIPES[idx] = recipe;
  } else {
    CUSTOM_RECIPES.push(recipe);
  }

  toast("âœ… Recette ajoutÃ©e au swipe !");
  resetCreateForm();
  switchCreateTab("list");
}

/* â”€â”€ Init create screen (called once) â”€â”€ */
function initCreateScreen(){
  // Tab switching
  var tabList = document.getElementById("cr-tab-list");
  var tabForm = document.getElementById("cr-tab-form");
  var btnNew  = document.getElementById("btn-show-form");

  if(tabList) tabList.addEventListener("click", function(){ switchCreateTab("list"); });
  if(tabForm) tabForm.addEventListener("click", function(){ switchCreateTab("form"); });
  if(btnNew)  btnNew.addEventListener("click",  function(){ switchCreateTab("form"); });

  // Emoji picker
  var emojiPicker = document.getElementById("cf-emoji-picker");
  if(emojiPicker){
    emojiPicker.addEventListener("click", function(e){
      var btn = e.target.closest(".cf-emoji-btn");
      if(!btn) return;
      document.querySelectorAll(".cf-emoji-btn").forEach(function(b){b.classList.remove("sel");});
      btn.classList.add("sel");
      _cfState.emoji = btn.getAttribute("data-emoji");
    });
  }

  // Gradient picker
  var gradPicker = document.getElementById("cf-grad-picker");
  if(gradPicker){
    gradPicker.addEventListener("click", function(e){
      var sw = e.target.closest(".cf-swatch");
      if(!sw) return;
      document.querySelectorAll(".cf-swatch").forEach(function(s){s.classList.remove("sel");});
      sw.classList.add("sel");
      _cfState.grad = sw.getAttribute("data-grad");
    });
  }

  // Tag preset buttons
  var tagsWrap = document.getElementById("cf-tags-preset");
  if(tagsWrap){
    tagsWrap.addEventListener("click", function(e){
      var btn = e.target.closest(".cf-tag");
      if(!btn) return;
      var tag = btn.getAttribute("data-tag");
      var idx = _cfState.tags.indexOf(tag);
      if(idx === -1){
        _cfState.tags.push(tag);
        btn.classList.add("sel");
      } else {
        _cfState.tags.splice(idx, 1);
        btn.classList.remove("sel");
      }
    });
  }

  // Custom tag add
  var tagInp = document.getElementById("cf-tag-custom");
  var tagAddBtn = document.getElementById("cf-tag-add-btn");
  function addCustomTag(){
    if(!tagInp) return;
    var v = tagInp.value.trim().toUpperCase();
    if(!v || _cfState.tags.indexOf(v) !== -1){ tagInp.value=""; return; }
    _cfState.tags.push(v);
    // Add a new tag chip
    var newTag = document.createElement("button");
    newTag.className = "cf-tag sel";
    newTag.setAttribute("data-tag", v);
    newTag.textContent = v;
    newTag.addEventListener("click", function(){
      var ti = _cfState.tags.indexOf(v);
      if(ti !== -1){ _cfState.tags.splice(ti,1); newTag.remove(); }
    });
    if(tagsWrap) tagsWrap.appendChild(newTag);
    tagInp.value = "";
  }
  if(tagAddBtn) tagAddBtn.addEventListener("click", addCustomTag);
  if(tagInp) tagInp.addEventListener("keydown", function(e){ if(e.key==="Enter"){ e.preventDefault(); addCustomTag(); } });

  // Add ingredient row
  var addIngBtn = document.getElementById("cf-add-ing");
  if(addIngBtn) addIngBtn.addEventListener("click", function(){ addIngSlot(); });
  // Start with 2 empty slots
  _cfState.ingredients = [{name:"",qty:""},{name:"",qty:""}];
  refreshIngList();

  // Photo
  bindPhotoInput();

  // Submit
  var submitBtn = document.getElementById("cf-submit");
  if(submitBtn) submitBtn.addEventListener("click", saveCustomRecipe);
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INGREDIENT CATEGORIES MAP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var ING_CATEGORIES={
  legumes:["courgette","aubergine","poivron","tomate","oignon","ail","haricot","epinard","roquette","concombre","carotte","poireau","champignon","shiitake","ciboule"],
  viandes:["entrecote","agneau","jambon","thon","saumon","gambas","anchois","poulet","boeuf","veau","canard"],
  laitiers:["beurre","creme","gruyere","burrata","mascarpone","lait","parmesan","fromage","mozzarella"],
  epicerie:["farine","sucre","miel","huile","sauce soja","vinaigre","miso","curry","ras el-hanout","cannelle","sesame","dukkah","moutarde","capres","herbes","thym","estragon","persil","basilic","safran","piment","sel","poivre"],
  feculents:["raviole","pate","riz","semoule","pain","pate Ã  pizza","ramen","lentille","feuillet"],
  fruits:["pomme","orange","citron","avocat","prune","amande","noix","olives"],
  boissons:["lait de coco","grand marnier","cognac","vin","bouillon","eau"]
};

function categorizeIngredient(name){
  var n=name.toLowerCase();
  var cats=Object.keys(ING_CATEGORIES);
  for(var i=0;i<cats.length;i++){
    var words=ING_CATEGORIES[cats[i]];
    for(var j=0;j<words.length;j++){
      if(n.indexOf(words[j])!==-1) return cats[i];
    }
  }
  return "epicerie";
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UNIT NORMALIZATION â€” convert to canonical
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var UNIT_NORM={
  "ml":1,"cl":10,"dl":100,"l":1000,
  "g":1,"kg":1000,"mg":0.001,
  "c.s.":15,"c.c.":5,"tasse":250
};
// Returns {value, unit} where unit is canonical (ml or g or piece)
function parseQty(qtyStr){
  if(!qtyStr) return null;
  var s=qtyStr.trim().toLowerCase();
  // Match patterns like "20cl", "2 c.s.", "3", "Â½ bouquet"
  var m=s.match(/^([\d\/Â½Â¼Â¾,.]+)\s*(.*)$/);
  if(!m) return {value:1,unit:s||"pce",raw:qtyStr};
  var numStr=m[1].replace(",",".").replace("Â½","0.5").replace("Â¼","0.25").replace("Â¾","0.75");
  // handle fractions like "1/2"
  if(numStr.indexOf("/")!==-1){
    var parts=numStr.split("/");
    numStr=(parseFloat(parts[0])/parseFloat(parts[1])).toString();
  }
  var num=parseFloat(numStr)||1;
  var unit=m[2].trim();
  return {value:num,unit:unit||"pce",raw:qtyStr};
}

function normalizeToBase(parsed){
  if(!parsed) return {value:1,baseUnit:"pce"};
  var u=parsed.unit.toLowerCase();
  // volume in ml
  if(UNIT_NORM[u]!==undefined){
    return{value:parsed.value*UNIT_NORM[u],baseUnit:isVolumeUnit(u)?"ml":"g"};
  }
  return{value:parsed.value,baseUnit:u};
}

function isVolumeUnit(u){
  return ["ml","cl","dl","l","c.s.","c.c.","tasse"].indexOf(u)!==-1;
}

function formatQty(value,baseUnit){
  if(baseUnit==="ml"){
    if(value>=1000) return (value/1000).toFixed(1).replace(".0","")+"l";
    if(value>=100)  return (value/100).toFixed(1).replace(".0","")+"dl";
    if(value>=10)   return (value/10).toFixed(0)+"cl";
    return value.toFixed(0)+"ml";
  }
  if(baseUnit==="g"){
    if(value>=1000) return (value/1000).toFixed(1).replace(".0","")+"kg";
    return value.toFixed(0)+"g";
  }
  // pce: show just the number (or raw qty string if value is clean)
  if(isNaN(value) || value <= 0) return baseUnit||"";
  var n = value%1===0 ? value.toFixed(0) : value.toFixed(1);
  return baseUnit && baseUnit !== "pce" ? n+" "+baseUnit : n+" pce";
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE â€” single source of truth
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â”€â”€ Real-week helpers â”€â”€ */
function getMonday(){
  var d=new Date();
  var day=d.getDay(); // 0=Sun
  var diff=(day===0)?-6:1-day;
  d.setDate(d.getDate()+diff);
  d.setHours(0,0,0,0);
  return d;
}
function addDays(d,n){var r=new Date(d);r.setDate(r.getDate()+n);return r;}
function fmtDay(d){return d.getDate();}
function fmtShort(d){
  var months=["jan.","fÃ©v.","mar.","avr.","mai","juin","juil.","aoÃ»t","sep.","oct.","nov.","dÃ©c."];
  return d.getDate()+" "+months[d.getMonth()];
}
function fmtFull(d){
  var months=["jan.","fÃ©v.","mar.","avr.","mai","juin","juil.","aoÃ»t","sep.","oct.","nov.","dÃ©c."];
  return d.getDate()+" "+months[d.getMonth()]+" "+d.getFullYear();
}
function getWeekLabel(){
  var mon=getMonday();
  var sun=addDays(mon,6);
  return "Semaine du "+fmtShort(mon)+" au "+fmtFull(sun);
}

var DAYS=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"];
var DAYS_FULL=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"];

var state={
  likedIds:[],        // recipe IDs liked
  selectedIds:[],     // IDs selected in cart
  selectMode:false,

  // weekPlanning: { "0-midi": recipeId, "0-soir": recipeId, ... }
  weekPlanning:{},

  // checkedItems: Set of item keys that user has checked off in shopping
  checkedItems:{},    // key -> true

  portions:2,
  cardIndex:0,
  detailFrom:"main",
  detailRecipeId:0,

  // planning picker state
  pickerRecipeId:null,
  pickerDay:0,
  pickerTime:"midi",

  // User profile
  profile:{
    email:"",
    diet:"Omnivore",      // Omnivore | VÃ©gÃ©tarien | Vegan | Keto
    allergies:[],         // ["Lactose", "Gluten", ...]
    disliked:[],          // ["coriandre", "anchois", ...]
    notifications:true,
    darkMode:false
  },

  // Swipe session â€” IDs seen this session (like OR pass), reset on restart
  seenIds:{}
};

// shoppingList is DERIVED â€” never stored
function computeShoppingList(){
  // 1. Collect all recipe IDs in planning
  var recipeIds={};
  Object.keys(state.weekPlanning).forEach(function(k){
    var id=state.weekPlanning[k];
    recipeIds[id]=(recipeIds[id]||0)+1;
  });
  // 2. Aggregate ingredients
  // accumulated[normName] = {value, baseUnit, rawUnit, count}
  var accumulated={};
  Object.keys(recipeIds).forEach(function(id){
    var r=getRecipe(parseInt(id));
    if(!r) return;
    var mult=recipeIds[id];
    r.ing.forEach(function(pair){
      var name=pair[0];
      var normName=name.toLowerCase().trim();
      var parsed=parseQty(pair[1]);
      var normed=normalizeToBase(parsed);
      if(!accumulated[normName]){
        accumulated[normName]={
          name:name,
          value:normed.value*mult,
          baseUnit:normed.baseUnit,
          rawUnit:parsed?parsed.unit:"pce",
          category:categorizeIngredient(name)
        };
      } else {
        // Only add if same base unit
        if(accumulated[normName].baseUnit===normed.baseUnit){
          accumulated[normName].value+=normed.value*mult;
        } else {
          // different units â€” just append as separate
          var altKey=normName+"_alt";
          if(!accumulated[altKey]){
            accumulated[altKey]={name:name,value:normed.value*mult,baseUnit:normed.baseUnit,rawUnit:parsed?parsed.unit:"pce",category:categorizeIngredient(name)};
          } else {
            accumulated[altKey].value+=normed.value*mult;
          }
        }
      }
    });
  });
  // 3. Group by category
  var grouped={};
  Object.keys(accumulated).forEach(function(k){
    var item=accumulated[k];
    var cat=item.category;
    if(!grouped[cat]) grouped[cat]=[];
    grouped[cat].push({
      key:k,
      name:item.name,
      qty:(item.baseUnit==="ml"||item.baseUnit==="g"||item.baseUnit==="pce")
            ? formatQty(item.value,item.baseUnit)
            : (item.rawUnit||item.baseUnit||""),
      category:cat
    });
  });
  return grouped;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAV â€” single source of truth
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var SCREEN_TAB={main:0,detail:0,saved:1,calendar:2,shopping:3,prefs:3,create:4,profile:0};

function updateNavIndicator(nav){
  var btns=nav.querySelectorAll(".nav-btn");
  var n=btns.length;
  var activeIdx=0;
  for(var i=0;i<n;i++) if(btns[i].classList.contains("active")){activeIdx=i;break;}
  nav.style.setProperty("--ind-l",(activeIdx/n*100).toFixed(3)+"%");
  nav.style.setProperty("--ind-w",(100/n).toFixed(3)+"%");
}

function setActiveNav(tabIdx){
  var navBars=document.querySelectorAll(".bottom-nav");
  for(var n=0;n<navBars.length;n++){
    var nav=navBars[n];
    var btns=nav.querySelectorAll(".nav-btn");
    for(var i=0;i<btns.length;i++) btns[i].classList.remove("active");
    if(btns[tabIdx]) btns[tabIdx].classList.add("active");
    updateNavIndicator(nav);
  }
}

function showScreen(id){
  var all=document.querySelectorAll(".screen");
  for(var i=0;i<all.length;i++){all[i].classList.remove("active");all[i].style.display="none";}
  var t=document.getElementById(id);
  if(t){t.style.display="flex";requestAnimationFrame(function(){t.classList.add("active");});}
}

function navigateTo(screenId){
  closeModal();
  if(screenId==="saved") renderSavedScreen();
  if(screenId==="calendar") renderCalendar();
  if(screenId==="shopping") renderShoppingList();
  if(screenId==="create") renderCreateScreen();
  var tabIdx=SCREEN_TAB[screenId];
  if(tabIdx!==undefined) setActiveNav(tabIdx);
  showScreen(screenId);
}
function goTo(id){navigateTo(id);}

function initNavBars(){
  var navBars=document.querySelectorAll(".bottom-nav");
  for(var n=0;n<navBars.length;n++){
    (function(nav){
      updateNavIndicator(nav);
      var btns=nav.querySelectorAll(".nav-btn");
      for(var i=0;i<btns.length;i++){
        (function(btn){
          btn.addEventListener("click",function(){
            btn.classList.add("tap");
            setTimeout(function(){btn.classList.remove("tap");},280);
            navigateTo(btn.getAttribute("data-goto"));
          });
        })(btns[i]);
      }
    })(navBars[n]);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL SYSTEM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openModal(id){
  document.getElementById("overlay").classList.add("show");
  document.getElementById(id).classList.add("open");
}
function closeModal(){
  document.getElementById("overlay").classList.remove("show");
  document.querySelectorAll(".modal").forEach(function(m){m.classList.remove("open");});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BADGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateBadges(pop){
  var n=state.likedIds.length;
  var mealN=Object.keys(state.weekPlanning).length;

  // Each nav has buttons: tab0=home, tab1=saved(liked), tab2=calendar, tab3=shopping
  document.querySelectorAll(".bottom-nav").forEach(function(nav){
    var btns=nav.querySelectorAll(".nav-btn");
    // Tab 1 (liked) badge
    var b1=btns[1]?btns[1].querySelector(".nav-badge"):null;
    if(b1){
      b1.textContent=n>0?n:"";
      if(n>0){
        if(!b1.classList.contains("show")) b1.classList.add("show");
        if(pop){b1.classList.remove("pop");void b1.offsetWidth;b1.classList.add("pop");}
      } else {
        b1.classList.remove("show","pop");
      }
    }
    // Tab 2 (calendar) badge
    var b2=btns[2]?btns[2].querySelector(".nav-badge"):null;
    if(b2){
      b2.textContent=mealN>0?mealN:"";
      if(mealN>0){
        if(!b2.classList.contains("show")) b2.classList.add("show");
      } else {
        b2.classList.remove("show","pop");
      }
    }
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIKE / UNLIKE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function isLiked(id){return state.likedIds.indexOf(id)!==-1;}
function likeRecipe(id){
  if(isLiked(id)) return false;
  state.likedIds.push(id);
  updateBadges(true);
  return true;
}
function unlikeRecipe(id){
  var i=state.likedIds.indexOf(id);
  if(i===-1) return;
  state.likedIds.splice(i,1);
  var si=state.selectedIds.indexOf(id);
  if(si!==-1) state.selectedIds.splice(si,1);
  updateBadges(false);
}
function getRecipe(id){
  var all=RECIPES.concat(CUSTOM_RECIPES);
  for(var i=0;i<all.length;i++) if(all[i].id===id) return all[i];
  return null;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var _toastT=null;
function toast(msg){
  clearTimeout(_toastT);
  var t=document.getElementById("toast");
  t.textContent=msg;t.classList.add("show");
  _toastT=setTimeout(function(){t.classList.remove("show");},2400);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SWIPE CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* Shuffled deck â€” reshuffled each time it's exhausted */
var _deck=[];
var _deckPos=0;
function _recipeMatchesProfile(r){
  var p=state.profile;
  var tags=[r.tag1||"", r.tag2||""];
  // Diet filter
  if(p.diet==="VÃ©gÃ©tarien"){
    var meatTags=["VIANDE","BOEUF","PORC","AGNEAU","POULET","CANARD"];
    for(var m=0;m<meatTags.length;m++) if(tags.indexOf(meatTags[m])!==-1) return false;
    var meatWords=["boeuf","porc","agneau","poulet","lardons","jambon","veau","canard","saucisse","steak","entrecote","hache"];
    if(r.ing) for(var i=0;i<r.ing.length;i++){
      var n=r.ing[i][0].toLowerCase();
      for(var m2=0;m2<meatWords.length;m2++) if(n.indexOf(meatWords[m2])!==-1) return false;
    }
  }
  if(p.diet==="Vegan"){
    var animalWords=["boeuf","porc","agneau","poulet","saumon","thon","crevette","oeuf","beurre","creme","fromage","lait","gruyere","parmesan","mozzarella","chevre","lardons","jambon","veau","canard","saucisse","steak"];
    if(r.ing) for(var i=0;i<r.ing.length;i++){
      var n=r.ing[i][0].toLowerCase();
      for(var a=0;a<animalWords.length;a++) if(n.indexOf(animalWords[a])!==-1) return false;
    }
  }
  if(p.diet==="Keto"){
    var carbTags=["PASTA","PIZZA","RIZ","CÃ‰RÃ‰ALES"];
    for(var m=0;m<carbTags.length;m++) if(tags.indexOf(carbTags[m])!==-1) return false;
    var carbWords=["pate","riz","farine","pain","semoule","pomme de terre","lentille","haricot","tortellini","raviole","pizza","couscous"];
    if(r.ing) for(var i=0;i<r.ing.length;i++){
      var n=r.ing[i][0].toLowerCase();
      for(var c=0;c<carbWords.length;c++) if(n.indexOf(carbWords[c])!==-1) return false;
    }
  }
  // Allergy filter â€” match allergy keyword in ingredient names
  var allergyMap={
    "Lactose":["lait","beurre","creme","fromage","gruyere","parmesan","mozzarella","chevre","yaourt","lactose"],
    "Gluten":["farine","pain","pate","tortellini","raviole","couscous","semoule","gluten"],
    "Arachides":["arachide","cacahuete","beurre de cacahuete"],
    "Crustaces":["crevette","homard","crabe","langouste","gambas"],
    "Oeufs":["oeuf","mayo"],
    "Poisson":["saumon","thon","cabillaud","sole","dorade","sardine","anchois","poisson"],
    "Noix":["noix","noisette","amande","cajou","pistache","pecan"],
    "Soja":["soja","tofu","miso","sauce soja","edamame"]
  };
  for(var ai=0;ai<p.allergies.length;ai++){
    var words=allergyMap[p.allergies[ai]]||[];
    if(r.ing) for(var i=0;i<r.ing.length;i++){
      var n=r.ing[i][0].toLowerCase();
      for(var w=0;w<words.length;w++) if(n.indexOf(words[w])!==-1) return false;
    }
  }
  return true;
}

function _buildDeck(keepSeen){
  var all=RECIPES.concat(CUSTOM_RECIPES);
  // Filter by profile
  var filtered=all.filter(function(r){ return _recipeMatchesProfile(r); });
  // If keepSeen=false (normal mode): exclude already seen in this session
  if(!keepSeen){
    var unseen=filtered.filter(function(r){ return !state.seenIds[r.id]; });
    // If all filtered recipes have been seen â†’ show end screen
    if(unseen.length===0){
      showSwipeEnd(filtered.length===0);
      return;
    }
    filtered=unseen;
  }
  // Shuffle
  _deck=filtered.slice();
  for(var i=_deck.length-1;i>0;i--){
    var j=Math.floor(Math.random()*(i+1));
    var t=_deck[i];_deck[i]=_deck[j];_deck[j]=t;
  }
  _deckPos=0;
  // Make sure swipe-end is hidden
  var se=document.getElementById("swipe-end");
  if(se) se.style.display="none";
}

function showSwipeEnd(noRecipes){
  var se=document.getElementById("swipe-end");
  if(!se) return;
  var title=se.querySelector(".swipe-end-title");
  var sub=se.querySelector(".swipe-end-sub");
  if(noRecipes){
    if(title) title.textContent="Aucune recette pour votre profil";
    if(sub) sub.textContent="Essayez d'ajuster vos prÃ©fÃ©rences dans votre profil.";
  } else {
    if(title) title.textContent="Vous avez tout vu !";
    if(sub) sub.textContent="Vous avez explorÃ© toutes les recettes disponibles pour votre profil.";
  }
  se.style.display="flex";
}
function currentRecipe(){
  if(_deck.length===0) _buildDeck();
  return _deck[_deckPos%_deck.length];
}

// Returns array of disliked ingredient names found in a recipe (for badge display)
function getDislikedMatches(r){
  var matches=[];
  var disliked=state.profile.disliked;
  if(!disliked.length || !r.ing) return matches;
  for(var di=0;di<disliked.length;di++){
    var dw=disliked[di].toLowerCase();
    for(var i=0;i<r.ing.length;i++){
      if(r.ing[i][0].toLowerCase().indexOf(dw)!==-1){
        if(matches.indexOf(disliked[di])===-1) matches.push(disliked[di]);
      }
    }
    if((r.title||"").toLowerCase().indexOf(dw)!==-1){
      if(matches.indexOf(disliked[di])===-1) matches.push(disliked[di]);
    }
  }
  return matches;
}

function renderCard(){
  var r=currentRecipe();
  var card=document.getElementById("swipe-card");
  card.style.cssText="";
  var img=document.getElementById("card-img");
  img.style.background=r.grad;
  if(r.photoUrl){
    img.innerHTML="<img src='"+r.photoUrl+"' style='width:100%;height:100%;object-fit:cover;position:absolute;inset:0;border-radius:inherit;'><div class='card-ov'></div>";
  } else {
    img.innerHTML="<span style='font-size:78px;position:relative;z-index:1'>"+r.emoji+"</span><div class='card-ov'></div>";
  }
  document.getElementById("ctitle").textContent=r.title;
  document.getElementById("cdesc").textContent=r.desc;
  document.getElementById("ctag1").textContent=r.tag1;
  document.getElementById("ctag2").textContent=r.tag2||"";
  document.getElementById("ctime").textContent=r.time;

  // Disliked badge
  var existing=document.getElementById("dislike-badge");
  if(existing) existing.remove();
  var matches=getDislikedMatches(r);
  if(matches.length){
    var badge=document.createElement("div");
    badge.id="dislike-badge";
    badge.style.cssText="position:absolute;top:12px;left:12px;z-index:10;background:rgba(0,0,0,.62);color:#fff;font-size:10px;font-weight:700;padding:4px 9px;border-radius:20px;backdrop-filter:blur(4px);display:flex;align-items:center;gap:4px;";
    badge.innerHTML="âš ï¸ Contient : "+matches.join(", ");
    card.appendChild(badge);
  }
}

function doSwipe(dir){
  var r=currentRecipe();
  var card=document.getElementById("swipe-card");
  var tx=dir==="left"?"-150%":"150%";
  var rot=dir==="left"?"-20deg":"20deg";
  document.getElementById("badge-left").style.opacity="0";
  document.getElementById("badge-right").style.opacity="0";
  card.style.transition="transform .36s ease,opacity .36s ease";
  card.style.transform="translateX("+tx+") rotate("+rot+")";
  card.style.opacity="0";
  if(dir==="right"){
    var added=likeRecipe(r.id);
    var sb=document.getElementById("btn-save");
    sb.classList.add("heart-burst");
    setTimeout(function(){sb.classList.remove("heart-burst");},420);
    toast(added?"âœ“ Recette sauvegardÃ©e !":"DÃ©jÃ  dans vos recettes");
  } else {
    toast("Recette passÃ©e");
  }
  setTimeout(function(){
    state.seenIds[r.id]=true;
    _deckPos++;
    if(_deckPos>=_deck.length) _buildDeck(false);
    card.style.transition="none";
    card.style.transform="scale(.82)";
    card.style.opacity="0";
    renderCard();
    requestAnimationFrame(function(){requestAnimationFrame(function(){
      card.style.transition="transform .3s cubic-bezier(.34,1.56,.64,1),opacity .26s ease";
      card.style.transform="";card.style.opacity="1";
    });});
  },380);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DETAIL VIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openDetail(recipeId,fromScreen){
  var r=getRecipe(recipeId);
  if(!r) return;
  state.detailFrom=fromScreen||"main";
  state.detailRecipeId=recipeId;
  var di=document.getElementById("det-img");
  di.style.background=r.grad;
  var back=document.getElementById("btn-det-back");
  var fav=document.getElementById("btn-det-fav");
  di.textContent="";
  if(r.photoUrl){
    // Custom recipe with photo
    var img=document.createElement("img");
    img.src=r.photoUrl;
    img.style.cssText="width:100%;height:100%;object-fit:cover;position:absolute;inset:0;";
    di.appendChild(img);
  } else {
    var es=document.createElement("span");
    es.style.cssText="font-size:100px;position:relative;z-index:1";
    es.textContent=r.emoji;
    di.appendChild(es);
  }
  di.appendChild(back);di.appendChild(fav);
  fav.textContent=isLiked(r.id)?"â™¥":"â˜…";
  document.getElementById("det-title").textContent=r.title;
  document.getElementById("det-desc").textContent=r.desc;
  document.getElementById("det-tag1").textContent=r.tag1;
  document.getElementById("det-tag2").textContent=r.time;
  var ingEl=document.getElementById("det-ing");
  ingEl.innerHTML="";
  r.ing.forEach(function(pair){
    var d=document.createElement("div");d.className="ing-item";
    d.innerHTML="<span class='ing-name'>"+pair[0]+"</span><span class='ing-qty'>"+pair[1]+"</span>";
    ingEl.appendChild(d);
  });
  var stEl=document.getElementById("det-steps");
  stEl.innerHTML="";
  r.steps.forEach(function(s,i){
    var d=document.createElement("div");d.className="step";
    d.innerHTML="<div class='step-n'>"+(i+1)+"</div><div class='step-t'>"+s+"</div>";
    stEl.appendChild(d);
  });
  setActiveNav(SCREEN_TAB["main"]);
  showScreen("detail");
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SAVED SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function exitSelectMode(){
  state.selectMode=false;state.selectedIds=[];
  document.getElementById("sel-toolbar").classList.remove("visible");
  document.getElementById("btn-select-mode").style.display="none";
  renderSavedScreen();
}
/* â”€â”€â”€ renderSavedScreen â€” iOS vertical list â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderSavedScreen(){
  var container = document.getElementById("saved-content");
  container.innerHTML = "";

  var n = state.likedIds.length;
  var countEl = document.getElementById("saved-count-label");
  if(countEl) countEl.textContent = n + (n<=1 ? " recette sauvegardÃ©e" : " recettes sauvegardÃ©es");

  if(n === 0){
    var empty = document.createElement("div");
    empty.className = "empty-state";
    empty.innerHTML = "<div class='ei'>â™¥</div><h3>Aucune recette</h3><p>Swipez Ã  droite pour sauvegarder des recettes ici.</p>";
    container.appendChild(empty);
    return;
  }

  var list = document.createElement("div");
  list.className = "saved-list";
  var section = document.createElement("div");
  section.className = "saved-section";

  state.likedIds.forEach(function(id, idx){
    var r = getRecipe(id);
    if(!r) return;

    var row = document.createElement("div");
    row.className = "rc-row";
    row.setAttribute("data-recipe-id", id);
    row.style.animationDelay = (idx * 45) + "ms";

    row.innerHTML =
      "<div class='rc-main'>" +
        "<div class='rc-photo' style='background:" + r.grad + "'>" +
          "<span>" + r.emoji + "</span>" +
        "</div>" +
        "<div class='rc-info'>" +
          "<div class='rc-title'>" + r.title + "</div>" +
          "<div class='rc-meta'>" + r.time + " Â· " + r.tag1 + "</div>" +
        "</div>" +
        "<div class='rc-portions'>" +
          "<span class='rc-portions-icon'>ğŸ‘¤</span>" +
          "<span>1 prs.</span>" +
        "</div>" +
        "<div class='rc-chevron'>â€º</div>" +
      "</div>" +
      "<div class='rc-actions'>" +
        "<button class='rc-action-btn del' data-del='" + id + "'>ğŸ—‘ Supprimer</button>" +
        "<button class='rc-action-btn detail' data-detail='" + id + "'>ğŸ“– DÃ©tails</button>" +
        "<button class='rc-action-btn plan' data-plan='" + id + "'>ğŸ“… Planning</button>" +
      "</div>";

    /* Toggle expand on main row tap */
    var mainLine = row.querySelector(".rc-main");
    mainLine.addEventListener("click", function(){
      var wasExpanded = row.classList.contains("expanded");
      /* Collapse all others */
      section.querySelectorAll(".rc-row.expanded").forEach(function(r2){
        r2.classList.remove("expanded");
      });
      if(!wasExpanded) row.classList.add("expanded");
    });

    /* Actions */
    row.querySelector("[data-del]").addEventListener("click", function(e){
      e.stopPropagation();
      row.classList.add("card-exit");
      setTimeout(function(){
        unlikeRecipe(id);
        renderSavedScreen();
      }, 220);
      toast("Recette retirÃ©e");
    });

    row.querySelector("[data-detail]").addEventListener("click", function(e){
      e.stopPropagation();
      openDetail(id, "saved");
    });

    row.querySelector("[data-plan]").addEventListener("click", function(e){
      e.stopPropagation();
      openPlanningPicker(id);
    });

    section.appendChild(row);
  });

  list.appendChild(section);
  container.appendChild(list);
}


function toggleSelectCard(id, cardEl){ /* noop â€” select mode removed */ }
function exitSelectMode(){ state.selectMode=false; state.selectedIds=[]; }


function openPlanningPicker(recipeId){
  resetPlanModal();
  state.pickerRecipeId=recipeId;
  state.pickerDay=0;
  state.pickerTime="midi";
  // Build day grid
  var grid=document.getElementById("plan-day-grid");
  grid.innerHTML="";
  DAYS.forEach(function(d,i){
    var btn=document.createElement("button");
    btn.className="plan-day-btn"+(i===0?" selected":"");
    btn.textContent=d;
    btn.addEventListener("click",function(){
      grid.querySelectorAll(".plan-day-btn").forEach(function(b){b.classList.remove("selected");});
      btn.classList.add("selected");
      state.pickerDay=i;
    });
    grid.appendChild(btn);
  });
  // Time buttons
  document.getElementById("pt-midi").classList.add("selected");
  document.getElementById("pt-soir").classList.remove("selected");
  state.pickerTime="midi";
  openModal("plan-modal");
}

function confirmPlanning(){
  // Null-guard: pickerRecipeId must be a valid number
  if(state.pickerRecipeId===null || state.pickerRecipeId===undefined) return;
  var r=getRecipe(state.pickerRecipeId);
  if(!r){ toast("Recette introuvable"); return; }
  var key=state.pickerDay+"-"+state.pickerTime;
  state.weekPlanning[key]=state.pickerRecipeId;
  state.checkedItems={};
  updateBadges(false);
  closeModal();
  // Always keep calendar + shopping in sync
  renderCalendar();
  renderShoppingList();
  var dayName=DAYS_FULL[state.pickerDay];
  var moment=state.pickerTime==="midi"?"Ã  midi":"le soir";
  toast("ğŸ“… "+r.title+" ajoutÃ©e "+moment+" ("+dayName+")");
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CALENDAR SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderCalendar(){
  var strip=document.getElementById("week-strip");
  strip.innerHTML="";
  // Force inline styles to prevent any external override (e.g. Cloudflare injection)
  strip.style.cssText="display:flex!important;flex-direction:row!important;width:100%;padding:0 12px 10px;box-sizing:border-box;flex-shrink:0;";
  var today=new Date().getDay();
  var todayIdx=(today===0)?6:today-1;
  var monday=getMonday();
  DAYS.forEach(function(d,i){
    var dayDate=addDays(monday,i);
    var col=document.createElement("div");
    col.style.cssText="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;min-width:0;";
    var lbl=document.createElement("div");
    lbl.style.cssText="font-size:9px;font-weight:700;color:#6B7280;letter-spacing:.5px;text-transform:uppercase;";
    lbl.textContent=d;
    var num=document.createElement("div");
    var isToday=(i===todayIdx);
    num.style.cssText="width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;"+(isToday?"background:#FF3E7F;color:#fff;":"color:#1A1A2E;");
    num.textContent=fmtDay(dayDate);
    col.appendChild(lbl);col.appendChild(num);
    strip.appendChild(col);
  });

  var body=document.getElementById("cal-body");
  body.innerHTML="";
  var moments=["midi","soir"];
  var hasAny=false;

  DAYS_FULL.forEach(function(dayFull,dayIdx){
    var dayHasMeal=false;
    moments.forEach(function(m){
      if(state.weekPlanning[dayIdx+"-"+m]) dayHasMeal=true;
    });

    var sec=document.createElement("div");
    sec.className="cal-day-section";
    var titleEl=document.createElement("div");
    titleEl.className="cal-day-title";
    titleEl.textContent=dayFull;
    sec.appendChild(titleEl);

    moments.forEach(function(moment){
      var key=dayIdx+"-"+moment;
      var rid=state.weekPlanning[key];
      if(rid!==undefined){
        hasAny=true;
        var r=getRecipe(rid);
        if(!r) return;
        var slot=document.createElement("div");
        slot.className="meal-slot";
        slot.setAttribute("draggable","true");
        slot.setAttribute("data-key",key);
        slot.innerHTML=
          "<div class='meal-emoji'>"+r.emoji+"</div>"+
          "<div class='meal-info'>"+
            "<span class='meal-time-badge "+moment+"'>"+moment.toUpperCase()+"</span>"+
            "<div class='meal-title'>"+r.title+"</div>"+
            "<div class='meal-meta'>"+r.time+" â€¢ "+r.tag1+"</div>"+
          "</div>"+
          "<button class='meal-remove' data-key='"+key+"'>âœ•</button>";
        // Click to detail
        slot.addEventListener("click",function(e){
          if(e.target.closest(".meal-remove")) return;
          openDetail(rid,"calendar");
        });
        // Remove
        slot.querySelector(".meal-remove").addEventListener("click",function(e){
          e.stopPropagation();
          delete state.weekPlanning[key];
          renderCalendar();
          renderShoppingList();
          state.checkedItems={};
        updateBadges(false);
        toast("Repas retirÃ© du planning");
        });
        // Drag start
        slot.addEventListener("dragstart",function(e){
          e.dataTransfer.setData("text/plain",key);
          slot.style.opacity=".5";
        });
        slot.addEventListener("dragend",function(){slot.style.opacity="";});
        sec.appendChild(slot);
      } else {
        // Empty slot â€” click to add
        var empty=document.createElement("div");
        empty.className="meal-slot-empty";
        empty.innerHTML="<span style='font-size:16px'>"+(moment==="midi"?"ğŸŒ¤ï¸":"ğŸŒ™")+"</span><span>Ajouter un repas du "+moment+"â€¦</span>";
        empty.addEventListener("click",function(){
          // Quick add: open planning picker defaulting to this day/moment
          if(state.likedIds.length===0){toast("Sauvegardez des recettes d'abord");return;}
          state.pickerDay=dayIdx;
          state.pickerTime=moment;
          // Show a simple recipe picker
          openQuickAddPicker(dayIdx,moment);
        });
        // Drop target
        empty.addEventListener("dragover",function(e){e.preventDefault();empty.classList.add("drag-over");});
        empty.addEventListener("dragleave",function(){empty.classList.remove("drag-over");});
        empty.addEventListener("drop",function(e){
          e.preventDefault();
          empty.classList.remove("drag-over");
          var fromKey=e.dataTransfer.getData("text/plain");
          var rid2=state.weekPlanning[fromKey];
          if(rid2!==undefined){
            if(fromKey === key){ toast("MÃªme emplacement"); return; }
            delete state.weekPlanning[fromKey];
            state.weekPlanning[key]=rid2;
            state.checkedItems={};
            updateBadges(false);
            renderCalendar();
            renderShoppingList();
            toast("Repas dÃ©placÃ© !");
          }
        });
        sec.appendChild(empty);
      }
    });
    body.appendChild(sec);
  });

  if(!hasAny){
    var hint=document.createElement("div");
    hint.style.cssText="text-align:center;padding:24px 20px;color:var(--gray);font-size:13px;line-height:1.7;";
    hint.innerHTML="<div style='font-size:42px;margin-bottom:10px;opacity:.3;'>ğŸ“…</div>Ajoutez des recettes depuis<br><b>Mes Recettes</b> ou via le swipe";
    body.appendChild(hint);
  }

  // Planning indicator
  var indic = document.getElementById("cal-shop-indicator");
  if(indic){
    var mealCount = Object.keys(state.weekPlanning).length;
    if(mealCount === 0){
      indic.style.display = "none";
    } else {
      var slots = mealCount;
      indic.style.display = "flex";
      indic.innerHTML =
        "<span style='font-size:12px;color:#FF3E7F;font-weight:600;'>"+slots+" repas planifiÃ©"+(slots>1?"s":"")+" cette semaine</span>"+
        "<button style='background:none;border:none;font-size:11px;font-weight:700;color:#FF3E7F;cursor:pointer;white-space:nowrap;padding:0;text-decoration:underline;' id='cal-go-shop'>Voir les courses â†’</button>";
      var goBtn = document.getElementById("cal-go-shop");
      if(goBtn) goBtn.addEventListener("click", function(){ navigateTo("shopping"); });
    }
  }
}

/* Quick add picker â€” shows liked recipes list inline in a modal */
function resetPlanModal(){
  // Restore all controls to default state before opening either picker
  document.querySelector("#plan-modal .modal-title").textContent="Ajouter au planning";
  document.getElementById("pt-midi").style.display="";
  document.getElementById("pt-soir").style.display="";
  document.getElementById("btn-confirm-plan").style.display="";
  document.getElementById("plan-day-grid").innerHTML="";
}

function openQuickAddPicker(dayIdx,moment){
  resetPlanModal();
  state.pickerDay=dayIdx;state.pickerTime=moment;
  var modal=document.getElementById("plan-modal");
  modal.querySelector(".modal-title").textContent=DAYS_FULL[dayIdx]+" â€” "+moment;
  // Hide day/time row and confirm; show recipe list instead
  document.getElementById("pt-midi").style.display="none";
  document.getElementById("pt-soir").style.display="none";
  document.getElementById("btn-confirm-plan").style.display="none";
  // Recipe list
  var grid=document.getElementById("plan-day-grid");
  grid.innerHTML="";
  if(state.likedIds.length===0){
    var hint=document.createElement("p");
    hint.style.cssText="color:var(--gray);font-size:13px;grid-column:span 7;padding:8px 0;";
    hint.textContent="Sauvegardez d'abord des recettes via le swipe.";
    grid.appendChild(hint);
  } else {
    state.likedIds.forEach(function(id){
      var r=getRecipe(id);if(!r) return;
      var btn=document.createElement("button");
      btn.style.cssText="grid-column:span 7;width:100%;text-align:left;padding:10px 12px;border-radius:12px;border:2px solid var(--gray-light);background:transparent;font-family:inherit;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;margin-bottom:6px;transition:all .15s;";
      btn.innerHTML="<span style='font-size:22px'>"+r.emoji+"</span><div><div style='color:var(--dark)'>"+r.title+"</div><div style='color:var(--gray);font-size:10px;font-weight:400'>"+r.time+" â€¢ "+r.tag1+"</div></div>";
      btn.addEventListener("mouseenter",function(){btn.style.borderColor="var(--pink)";btn.style.background="var(--pink-soft)";});
      btn.addEventListener("mouseleave",function(){btn.style.borderColor="var(--gray-light)";btn.style.background="transparent";});
      btn.addEventListener("click",function(){
        state.weekPlanning[dayIdx+"-"+moment]=id;
        state.checkedItems={};
        updateBadges(false);
        closeModal();
        renderCalendar();
        renderShoppingList();
        toast("ğŸ“… "+r.title+" ajoutÃ©e !");
      });
      grid.appendChild(btn);
    });
  }
  openModal("plan-modal");
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHOPPING LIST SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COST ESTIMATION â€” prix indicatifs (â‚¬/kg ou â‚¬/piÃ¨ce)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* Prix au kilo (â‚¬/kg) â€” pour ingrÃ©dients pesÃ©s */
var PRICE_DB = {
  // lÃ©gumes â‚¬/kg GMS France 2024-2025
  tomate:2.5, courgette:2.0, aubergine:2.8, poivron:3.5, carotte:1.5,
  oignon:1.5, epinard:4.0, champignon:6.0, pomme_de_terre:1.2,
  // viandes & poissons â‚¬/kg
  boeuf:16.0, veau:20.0, porc:9.0, poulet:7.5, agneau:22.0,
  saumon:22.0, thon:16.0, crevette:22.0, jambon:12.0,
  entrecote:28.0, hache:10.0, saucisse:8.0, lardons:7.0, gambas:28.0,
  // laitiers â‚¬/kg ou â‚¬/l
  beurre:12.0, creme:4.0, lait:1.2, gruyere:14.0,
  parmesan:22.0, mozzarella:12.0, chevre:18.0,
  // fÃ©culents â‚¬/kg
  pate:2.0, riz:2.5, semoule:2.0, lentille:3.0,
  raviole:8.0, tortellini:9.0, farine:1.2,
  // Ã©picerie â‚¬/kg ou â‚¬/l
  huile:7.0, sauce_soja:8.0, miso:12.0, curry:20.0,
  tomate_concassee:1.8, haricot:1.5, pesto:12.0, bouillon:3.0,
  miel:12.0, sucre:1.5,
  // fruits â‚¬/kg
  citron:2.5, orange:2.0, pomme:2.5, prune:4.0
};

/* Prix Ã  la piÃ¨ce (â‚¬/piÃ¨ce) â€” pour ingrÃ©dients achetÃ©s Ã  l'unitÃ© */
var PRICE_UNIT = {
  // lÃ©gumes piÃ¨ce
  tomate:0.40, courgette:0.80, aubergine:1.10, poivron:0.90, carotte:0.25,
  oignon:0.35, concombre:0.85, laitue:1.20, salade:1.20, avocat:1.10,
  // fruits piÃ¨ce
  citron:0.35, orange:0.55, pomme:0.45,
  // viandes piÃ¨ce
  poulet:8.50,  // poulet entier ~1,2 kg Ã  7,5â‚¬/kg
  steak:3.50,   // steak ~200g
  saucisse:0.80,
  gambas:1.20,  // grosse gambas royale
  // laitiers piÃ¨ce
  oeuf:0.25,
  fromage:4.50, // portion fromage
  chevre:2.20,  // rondelle de chÃ¨vre
  // Ã©picerie piÃ¨ce
  pain:1.80     // pain de mie (paquet)
};

// Normalize ingredient name â†’ lookup key
function normIngName(raw){
  return raw.toLowerCase()
    .replace(/fraÃ®che?s?|rÃ¢pÃ©[es]?|concassÃ©[es]?|hachÃ©[es]?|grillÃ©[es]?|entier[es]?|dÃ©cortiquÃ©[es]?|en conserve|en boÃ®te/g,"")
    .replace(/[^a-zÃ¡Ã©Ã¨ÃªÃ®Ã¹Ã Ã´Ã»Ã§\s]/g,"")
    .replace(/\s+/g," ").trim()
    .replace(/ /g,"_")
    .replace(/s$/,""); // crude singular
}

// Parse quantity string â†’ grams or pieces (float)
function parseCostQty(qtyStr){
  if(!qtyStr) return {val:1, unit:"pce"};
  var s = qtyStr.toLowerCase().trim();
  if(/goÃ»t|qs|selon|facultatif|pincÃ©e|pincee|gousse|bouquet/.test(s)) return {val:0.01, unit:"pce"};
  var m = s.match(/^([0-9]+\/[0-9]+|[0-9]+[,.][0-9]+|[0-9]+)/);
  var num = 1;
  if(m){
    var raw = m[1];
    if(raw.indexOf("/")!==-1){ var p=raw.split("/"); num=parseFloat(p[0])/parseFloat(p[1]); }
    else num = parseFloat(raw.replace(",",".")) || 1;
  }
  if(isNaN(num) || num<=0) num=1;
  if(/kg/.test(s))               return {val:num*1000, unit:"g"};
  if(/cl/.test(s))               return {val:num*10,   unit:"ml"};
  if(/dl/.test(s))               return {val:num*100,  unit:"ml"};
  if(/ml/.test(s))               return {val:num,      unit:"ml"};
  if(/c\.s\.|cuill|tbsp/.test(s)) return {val:num*15, unit:"ml"};
  if(/c\.c\.|tsp/.test(s))     return {val:num*5,    unit:"ml"};
  if(/[0-9]g|^g | g$/.test(s))  return {val:num,      unit:"g"};
  if(/ l$|^l /.test(s))         return {val:num*1000,  unit:"ml"};
  return {val:num, unit:"pce"};
}

// Estimate cost for one item: {name, qty}
function estimateItemCost(name, qty){
  var key = normIngName(name);
  var keys = Object.keys(PRICE_DB);
  var pricePerKg = null;
  if(PRICE_DB[key] !== undefined) pricePerKg = PRICE_DB[key];
  else {
    var best = "";
    for(var i=0;i<keys.length;i++){
      if(key.indexOf(keys[i]) !== -1 && keys[i].length > best.length) best = keys[i];
    }
    if(best) pricePerKg = PRICE_DB[best];
  }
  if(pricePerKg === null) pricePerKg = 3.0;

  var q = parseCostQty(qty);
  if(q.unit === "g")   return pricePerKg * q.val / 1000;
  if(q.unit === "ml")  return pricePerKg * q.val / 1000;
  // piece: check PRICE_UNIT first (real unit prices), then fall back to kg Ã— estimated weight
  if(PRICE_UNIT[key] !== undefined) return PRICE_UNIT[key] * q.val;
  // fuzzy match in PRICE_UNIT
  var ukeys = Object.keys(PRICE_UNIT);
  for(var u=0;u<ukeys.length;u++){
    if(key.indexOf(ukeys[u])!==-1 || ukeys[u].indexOf(key)!==-1){
      return PRICE_UNIT[ukeys[u]] * q.val;
    }
  }
  // last resort: kg price Ã— typical weight per piece (0.15 kg default)
  var pieceWeights = {oeuf:0.06,oignon:0.15,ail:0.03,carotte:0.12,courgette:0.25,
    aubergine:0.35,poivron:0.20,tomate:0.18,citron:0.12,avocat:0.22,pomme:0.20,
    concombre:0.35,champignon:0.10,pomme_de_terre:0.15};
  var w = pieceWeights[key] || 0.15;
  return pricePerKg * w * q.val;
}

// Main: estimate total from grouped shopping list
function estimateShoppingCost(grouped){
  var total = 0;
  Object.values(grouped).forEach(function(items){
    items.forEach(function(item){
      total += estimateItemCost(item.name, item.qty);
    });
  });
  return total;
}

function renderShoppingList(){
  var body = document.getElementById("shop-body");
  body.innerHTML = "";

  // Update week label
  var weekLbl = document.getElementById("shop-week-label");
  if(weekLbl) weekLbl.textContent = getWeekLabel();

  var planCount = Object.keys(state.weekPlanning).length;
  var countEl = document.getElementById("shop-count-label");

  // Build recipe summary
  var summaryEl = document.getElementById("shop-recipes-summary");
  if(summaryEl){
    if(planCount === 0){
      summaryEl.style.display = "none";
    } else {
      // Collect unique recipe titles
      var seenIds = {};
      var recipeTitles = [];
      Object.values(state.weekPlanning).forEach(function(rid){
        if(!seenIds[rid]){ seenIds[rid]=true; var r=getRecipe(rid); if(r) recipeTitles.push(r.title); }
      });
      var inner = "<div style='font-size:11px;font-weight:700;color:#6B7280;letter-spacing:.4px;text-transform:uppercase;margin-bottom:6px;'>GÃ©nÃ©rÃ©e Ã  partir de "+recipeTitles.length+" recette"+(recipeTitles.length>1?"s":"")+" :</div>";
      recipeTitles.forEach(function(t){
        inner += "<div style='font-size:12px;color:#1A1A2E;padding:2px 0 2px 10px;border-left:2px solid #FF3E7F;margin-bottom:3px;'>"+t+"</div>";
      });
      summaryEl.innerHTML = inner;
      summaryEl.style.display = "block";
    }
  }

  if(planCount === 0){
    if(countEl) countEl.textContent = "Planifiez des repas pour gÃ©nÃ©rer la liste";
    var _ce = document.getElementById("shop-cost-label"); if(_ce) _ce.style.display = "none";
    var em = document.createElement("div");
    em.style.cssText = "display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 30px;text-align:center;";
    var emIcon = document.createElement("div");
    emIcon.style.cssText = "font-size:52px;opacity:.3;margin-bottom:14px;";
    emIcon.textContent = "ğŸ›’";
    var emTitle = document.createElement("div");
    emTitle.style.cssText = "font-family:'Playfair Display',Georgia,serif;font-size:18px;font-weight:700;color:#1A1A2E;margin-bottom:8px;";
    emTitle.textContent = "Liste vide";
    var emSub = document.createElement("div");
    emSub.style.cssText = "font-size:12px;color:#6B7280;line-height:1.7;";
    emSub.innerHTML = "Ajoutez des recettes Ã  votre planning<br>pour gÃ©nÃ©rer la liste automatiquement.";
    em.appendChild(emIcon); em.appendChild(emTitle); em.appendChild(emSub);
    body.appendChild(em);
    return;
  }

  var grouped = computeShoppingList();

  // Cost estimation
  var costEl = document.getElementById("shop-cost-label");
  var costVal = document.getElementById("shop-cost-value");
  if(costEl && costVal){
    var est = estimateShoppingCost(grouped);
    if(est > 0){
      costEl.style.display = "inline-flex";
      costVal.textContent = est.toFixed(1).replace(".",",") + " â‚¬";
    } else {
      costEl.style.display = "none";
    }
  }

  var catOrder = ["legumes","viandes","laitiers","feculents","fruits","epicerie","boissons"];
  var catEmojis = {legumes:"ğŸ¥¦",viandes:"ğŸ¥©",laitiers:"ğŸ§€",feculents:"ğŸš",fruits:"ğŸ",epicerie:"ğŸ«™",boissons:"ğŸ¥›"};
  // Add any extra categories not in default order
  Object.keys(grouped).forEach(function(c){ if(catOrder.indexOf(c)===-1) catOrder.push(c); });

  var totalItems = 0, checkedCount = 0;

  catOrder.forEach(function(cat){
    var items = grouped[cat];
    if(!items || !items.length) return;
    totalItems += items.length;

    // Category section
    var section = document.createElement("div");
    section.style.cssText = "margin-bottom:16px;";

    // Category title
    var title = document.createElement("div");
    title.style.cssText = "font-size:10px;font-weight:700;color:#6B7280;letter-spacing:.7px;text-transform:uppercase;margin-bottom:6px;padding:0 2px;";
    title.textContent = (catEmojis[cat]||"ğŸ“¦") + "  " + cat.charAt(0).toUpperCase() + cat.slice(1);
    section.appendChild(title);

    // Items card
    var card = document.createElement("div");
    card.style.cssText = "background:#fff;border-radius:14px;overflow:hidden;box-shadow:0 1px 6px rgba(0,0,0,.06);";

    items.forEach(function(item, idx){
      var checked = !!state.checkedItems[item.key];
      if(checked) checkedCount++;

      var row = document.createElement("div");
      row.style.cssText = "display:flex;align-items:center;gap:12px;padding:12px 14px;" +
        (idx < items.length-1 ? "border-bottom:1px solid #F0F0F5;" : "") +
        (checked ? "opacity:.45;" : "") +
        "cursor:pointer;transition:opacity .15s;";

      // Checkbox
      var cb = document.createElement("div");
      cb.style.cssText = "width:22px;height:22px;border-radius:7px;border:2px solid " +
        (checked ? "#10B981;background:#10B981;" : "#D1D5DB;") +
        "display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:13px;color:#fff;transition:all .18s;";
      cb.textContent = checked ? "âœ“" : "";

      // Name
      var name = document.createElement("span");
      name.style.cssText = "flex:1;font-size:13px;font-weight:500;color:#1A1A2E;" +
        (checked ? "text-decoration:line-through;color:#9CA3AF;" : "");
      name.textContent = item.name;

      // Qty + unit price
      var qty = document.createElement("span");
      qty.style.cssText = "display:flex;flex-direction:column;align-items:flex-end;flex-shrink:0;gap:1px;";
      var qtyVal = document.createElement("span");
      qtyVal.style.cssText = "font-size:12px;font-weight:700;color:#FF3E7F;";
      qtyVal.textContent = item.qty;
      var unitCost = estimateItemCost(item.name, item.qty);
      var unitPriceEl = document.createElement("span");
      unitPriceEl.style.cssText = "font-size:10px;color:#9CA3AF;font-weight:500;";
      unitPriceEl.textContent = "â‰ˆ " + unitCost.toFixed(2).replace(".",",") + " â‚¬";
      qty.appendChild(qtyVal);
      qty.appendChild(unitPriceEl);

      row.appendChild(cb);
      row.appendChild(name);
      row.appendChild(qty);

      row.addEventListener("click", function(){
        if(state.checkedItems[item.key]){
          delete state.checkedItems[item.key];
        } else {
          state.checkedItems[item.key] = true;
        }
        renderShoppingList();
      });

      card.appendChild(row);
    });

    section.appendChild(card);
    body.appendChild(section);
  });

  if(countEl) countEl.textContent = totalItems + " ingrÃ©dient" + (totalItems>1?"s":"") + " Â· " + checkedCount + " cochÃ©" + (checkedCount>1?"s":"");
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PDF EXPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SWIPE GESTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initSwipeGesture(){
  var card=document.getElementById("swipe-card");
  var startX=0,isDragging=false;
  card.addEventListener("mousedown",function(e){startX=e.clientX;isDragging=true;card.classList.add("dragging");});
  document.addEventListener("mousemove",function(e){
    if(!isDragging) return;
    var dx=e.clientX-startX;
    card.style.transform="translateX("+dx+"px) rotate("+(dx*.046)+"deg)";
    document.getElementById("badge-left").style.opacity=dx<-18?Math.min(1,Math.abs(dx)/72):0;
    document.getElementById("badge-right").style.opacity=dx>18?Math.min(1,dx/72):0;
  });
  document.addEventListener("mouseup",function(e){
    if(!isDragging) return;
    isDragging=false;card.classList.remove("dragging");
    var dx=e.clientX-startX;
    document.getElementById("badge-left").style.opacity=0;
    document.getElementById("badge-right").style.opacity=0;
    if(dx<-80) doSwipe("left");
    else if(dx>80) doSwipe("right");
    else{card.style.transition="transform .28s ease";card.style.transform="";}
  });
  card.addEventListener("touchstart",function(e){startX=e.touches[0].clientX;isDragging=true;},{passive:true});
  document.addEventListener("touchmove",function(e){
    if(!isDragging) return;
    var dx=e.touches[0].clientX-startX;
    card.style.transform="translateX("+dx+"px) rotate("+(dx*.046)+"deg)";
    document.getElementById("badge-left").style.opacity=dx<-18?Math.min(1,Math.abs(dx)/72):0;
    document.getElementById("badge-right").style.opacity=dx>18?Math.min(1,dx/72):0;
  },{passive:true});
  document.addEventListener("touchend",function(e){
    if(!isDragging) return;
    isDragging=false;
    var dx=e.changedTouches[0].clientX-startX;
    document.getElementById("badge-left").style.opacity=0;
    document.getElementById("badge-right").style.opacity=0;
    if(dx<-80) doSwipe("left");
    else if(dx>80) doSwipe("right");
    else{card.style.transition="transform .28s ease";card.style.transform="";}
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BIND HELPER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function bind(id,fn){var el=document.getElementById(id);if(el) el.addEventListener("click",fn);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROFILE SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openProfile(){
  // Sync UI to current state.profile
  var p=state.profile;
  // Email
  var em=document.getElementById("prof-email");
  if(em) em.value=p.email||"";
  // Diet
  document.querySelectorAll(".prof2-diet-opt").forEach(function(el){
    var sel=el.getAttribute("data-diet")===p.diet;
    el.classList.toggle("sel",sel);
    var chk=el.querySelector(".prof2-diet-chk");
    if(chk) chk.textContent=sel?"âœ“":"";
  });
  // Allergies
  document.querySelectorAll(".prof2-allergy-chip").forEach(function(el){
    el.classList.toggle("sel", p.allergies.indexOf(el.getAttribute("data-allergy"))!==-1);
  });
  // Disliked
  renderDislikedTags();
  // Avatar sub
  var sub=document.getElementById("prof-display-diet");
  if(sub) sub.textContent=p.diet+(p.allergies.length?" Â· "+p.allergies.length+" allergie(s)":"");
  navigateTo("profile");
}

function renderDislikedTags(){
  var wrap=document.getElementById("prof-dislike-tags");
  if(!wrap) return;
  wrap.innerHTML="";
  state.profile.disliked.forEach(function(item,idx){
    var tag=document.createElement("div");
    tag.className="prof2-dislike-tag";
    tag.innerHTML="<span>"+item+"</span><button data-idx='"+idx+"'>âœ•</button>";
    tag.querySelector("button").addEventListener("click",function(){
      state.profile.disliked.splice(idx,1);
      renderDislikedTags();
    });
    wrap.appendChild(tag);
  });
}

function saveProfile(){
  var p=state.profile;
  var em=document.getElementById("prof-email");
  if(em) p.email=em.value.trim();
  // Rebuild deck with new profile (reset seen)
  state.seenIds={};
  _buildDeck(false);
  // Update avatar
  var sub=document.getElementById("prof-display-diet");
  if(sub) sub.textContent=p.diet+(p.allergies.length?" Â· "+p.allergies.length+" allergie(s)":"");
  toast("âœ… Profil sauvegardÃ© !");
  navigateTo("main");
}

function initProfileScreen(){
  // Back button
  var back=document.getElementById("btn-profile-back");
  if(back) back.addEventListener("click",function(){ navigateTo("main"); });
  // Save
  var save=document.getElementById("btn-profile-save");
  if(save) save.addEventListener("click",saveProfile);
  // Open profile btn in main header
  var open=document.getElementById("btn-open-profile");
  if(open) open.addEventListener("click",openProfile);
  // Diet options
  var dietGrid=document.getElementById("prof-diet-grid");
  if(dietGrid){
    dietGrid.addEventListener("click",function(e){
      var opt=e.target.closest(".prof2-diet-opt");
      if(!opt) return;
      state.profile.diet=opt.getAttribute("data-diet");
      document.querySelectorAll(".prof2-diet-opt").forEach(function(el){
        var sel=el===opt;
        el.classList.toggle("sel",sel);
        var chk=el.querySelector(".prof2-diet-chk");
        if(chk) chk.textContent=sel?"âœ“":"";
      });
    });
  }
  // Allergy chips
  var allergyGrid=document.getElementById("prof-allergy-grid");
  if(allergyGrid){
    allergyGrid.addEventListener("click",function(e){
      var chip=e.target.closest(".prof2-allergy-chip");
      if(!chip) return;
      var a=chip.getAttribute("data-allergy");
      var idx=state.profile.allergies.indexOf(a);
      if(idx===-1){ state.profile.allergies.push(a); chip.classList.add("sel"); }
      else { state.profile.allergies.splice(idx,1); chip.classList.remove("sel"); }
    });
  }
  // Disliked input
  var dinp=document.getElementById("prof-dislike-inp");
  var dadd=document.getElementById("prof-dislike-add");
  function addDisliked(){
    if(!dinp) return;
    var v=dinp.value.trim().toLowerCase();
    if(!v||state.profile.disliked.indexOf(v)!==-1){dinp.value="";return;}
    state.profile.disliked.push(v);
    renderDislikedTags();
    dinp.value="";
  }
  if(dadd) dadd.addEventListener("click",addDisliked);
  if(dinp) dinp.addEventListener("keydown",function(e){if(e.key==="Enter"){e.preventDefault();addDisliked();}});
  // Logout
  var logout=document.getElementById("btn-prof-logout");
  if(logout) logout.addEventListener("click",function(){navigateTo("splash");});
  // Swipe-end buttons
  var restart=document.getElementById("btn-swipe-restart");
  if(restart) restart.addEventListener("click",function(){
    state.seenIds={};
    _buildDeck(false);
    renderCard();
    var se=document.getElementById("swipe-end");
    if(se) se.style.display="none";
  });
  var goSaved=document.getElementById("btn-swipe-go-saved");
  if(goSaved) goSaved.addEventListener("click",function(){navigateTo("saved");});
}

function init(){
  // Onboarding
  bind("btn-start",function(){goTo("onboard");});
  bind("btn-to-allergies",function(){goTo("allergies");});
  bind("btn-login",function(){goTo("allergies");});
  bind("btn-to-diet",function(){goTo("diet");});
  bind("btn-skip-a",function(){goTo("diet");});
  bind("btn-to-main",function(){goTo("main");renderCard();});
  bind("btn-logout",function(){goTo("splash");});

  // Swipe
  bind("btn-pass",function(){doSwipe("left");});
  bind("btn-save",function(){doSwipe("right");});
  bind("btn-info",function(){openDetail(currentRecipe().id,"main");});

  // Detail
  bind("btn-det-back",function(){goTo(state.detailFrom);});
  bind("btn-det-fav",function(){
    var id=state.detailRecipeId;
    var btn=document.getElementById("btn-det-fav");
    if(isLiked(id)){unlikeRecipe(id);btn.textContent="â˜…";toast("Recette retirÃ©e");}
    else{likeRecipe(id);btn.textContent="â™¥";btn.classList.add("heart-burst");setTimeout(function(){btn.classList.remove("heart-burst");},420);toast("âœ“ Recette sauvegardÃ©e !");}
  });
  bind("btn-add-to-planning",function(){openPlanningPicker(state.detailRecipeId);});

  // Planning picker
  bind("pt-midi",function(){
    state.pickerTime="midi";
    document.getElementById("pt-midi").classList.add("selected");
    document.getElementById("pt-soir").classList.remove("selected");
  });
  bind("pt-soir",function(){
    state.pickerTime="soir";
    document.getElementById("pt-soir").classList.add("selected");
    document.getElementById("pt-midi").classList.remove("selected");
  });
  bind("btn-confirm-plan",function(){confirmPlanning();});

  // Portions
  bind("btn-pm",function(){state.portions=Math.max(1,state.portions-1);document.getElementById("pnum").textContent=state.portions;});
  bind("btn-pp",function(){state.portions=Math.min(10,state.portions+1);document.getElementById("pnum").textContent=state.portions;});

  // Filter modal
  bind("btn-filter",function(){openModal("filt-modal");});
  bind("overlay",function(){closeModal();});
  bind("btn-apply-filt",function(){closeModal();});
  for(var i=0;i<6;i++){(function(idx){var el=document.getElementById("fc"+idx);if(el) el.addEventListener("click",function(){el.classList.toggle("selected");});})(i);}
  var pills=document.querySelectorAll(".filt-pill");
  pills.forEach(function(p){p.addEventListener("click",function(){pills.forEach(function(q){q.classList.remove("active");});p.classList.add("active");});});

  // Allergy chips
  document.querySelectorAll(".allergy-chip").forEach(function(el){el.addEventListener("click",function(){el.classList.toggle("selected");});});

  // Diet
  for(var i=0;i<4;i++){(function(idx){var el=document.getElementById("diet"+idx);if(!el) return;
    el.addEventListener("click",function(){
      for(var j=0;j<4;j++){var d=document.getElementById("diet"+j);if(d){d.classList.remove("selected");d.querySelector(".diet-chk").textContent="";}}
      el.classList.add("selected");el.querySelector(".diet-chk").textContent="âœ“";
    });
  })(i);}

  // Toggles
  ["tog0","tog1","tog2"].forEach(function(id){var el=document.getElementById(id);if(el) el.addEventListener("click",function(){el.querySelector(".toggle").classList.toggle("on");});});

  // Saved multi-select
  bind("btn-select-mode",function(){
    state.selectMode=true;state.selectedIds=[];
    document.getElementById("sel-toolbar").classList.add("visible");
    document.getElementById("sel-info").textContent="0 sÃ©lectionnÃ©e(s)";
    renderSavedScreen();
  });
  bind("btn-cancel-sel",function(){exitSelectMode();});
  bind("btn-sel-all",function(){
    if(state.selectedIds.length===state.likedIds.length) state.selectedIds=[];
    else state.selectedIds=state.likedIds.slice();
    document.getElementById("sel-info").textContent=state.selectedIds.length+" sÃ©lectionnÃ©e(s)";
    renderSavedScreen();
  });
  bind("btn-del-selected",function(){
    if(!state.selectedIds.length){toast("Aucune sÃ©lection");return;}
    var cards=document.querySelectorAll(".saved-card.selected");
    cards.forEach(function(c){c.classList.add("card-exit");});
    var toRemove=state.selectedIds.slice();
    toast(toRemove.length+" recette(s) supprimÃ©e(s)");
    setTimeout(function(){
      toRemove.forEach(function(id){unlikeRecipe(id);});
      state.selectedIds=[];
      if(state.likedIds.length===0) exitSelectMode();
      else renderSavedScreen();
    },260);
  });

  // Calendar
  bind("btn-clear-week",function(){
    state.weekPlanning={};
    state.checkedItems={};
    updateBadges(false);
    renderCalendar();renderShoppingList();
    toast("Planning vidÃ©");
  });

  // Shopping
  // Shopping action buttons removed (export/reset/share)

  // Create recipe screen
  initCreateScreen();

  // Profile screen
  initProfileScreen();

  // Init nav
  initNavBars();
  setActiveNav(0);

  // Initial renders
  _buildDeck();
  renderCard();
  updateBadges(false);
}

if(document.readyState==="loading") document.addEventListener("DOMContentLoaded",init);
else init();


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PDF HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pdfHeader(doc,title,subtitle){
  var margin=18,pageW=210;
  doc.setFillColor(255,62,127);
  doc.rect(0,0,pageW,14,"F");
  doc.setFont("helvetica","bold");
  doc.setFontSize(13);doc.setTextColor(255,255,255);
  doc.text("RECIPY",margin,10);
  doc.setFont("helvetica","normal");
  doc.setFontSize(9);doc.text(subtitle,pageW-margin,10,"right");
  doc.setFontSize(18);doc.setFont("helvetica","bold");doc.setTextColor(26,26,46);
  doc.text(title,margin,26);
  doc.setDrawColor(230,230,230);doc.line(margin,31,pageW-margin,31);
  return 39;
}
function pdfSectionTitle(doc,title,y,margin){
  doc.setFontSize(11);doc.setFont("helvetica","bold");doc.setTextColor(255,62,127);
  doc.text(title,margin,y);
  return y+6;
}
function pdfCheckItem(doc,name,qty,y,margin,pageW){
  if(y>275){doc.addPage();y=20;}
  doc.setDrawColor(180,180,180);doc.rect(margin,y-3.5,3.5,3.5);
  doc.setFont("helvetica","normal");doc.setFontSize(10);doc.setTextColor(50,50,50);
  doc.text(name,margin+6,y);
  doc.setTextColor(255,62,127);doc.setFont("helvetica","bold");
  doc.text(qty,pageW-margin,y,"right");
  return y+6;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OPTION A â€” Planning complet + recettes + courses
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function exportFullPDF(){
  if(typeof window.jspdf==="undefined"){toast("PDF non disponible");return;}
  var jsPDF=window.jspdf.jsPDF;
  var doc=new jsPDF({orientation:"portrait",unit:"mm",format:"a4"});
  var margin=18,pageW=210,lineH=7;
  var y=pdfHeader(doc,"Planning de la semaine","Recipy â€” Export complet");

  y=pdfSectionTitle(doc,"Repas planifies",y,margin);
  var hasPlan=false;
  DAYS_FULL.forEach(function(day,di){
    ["midi","soir"].forEach(function(m){
      var rid=state.weekPlanning[di+"-"+m];
      if(rid===undefined) return;
      hasPlan=true;
      var r=getRecipe(rid);if(!r) return;
      if(y>275){doc.addPage();y=20;}
      doc.setFont("helvetica","bold");doc.setFontSize(10);doc.setTextColor(26,26,46);
      doc.text(day+" ["+(m==="midi"?"Midi":"Soir")+"]",margin,y);
      doc.setFont("helvetica","normal");doc.setTextColor(100,100,100);
      doc.text(r.title+" - "+r.time,margin+42,y);
      y+=lineH;
    });
  });
  if(!hasPlan){doc.setFont("helvetica","italic");doc.setFontSize(10);doc.setTextColor(150,150,150);doc.text("Aucun repas planifie.",margin,y);y+=lineH;}

  y+=4;if(y>255){doc.addPage();y=20;}
  doc.setDrawColor(230,230,230);doc.line(margin,y,pageW-margin,y);y+=8;
  y=pdfSectionTitle(doc,"Liste de courses consolidee",y,margin);
  var grouped=computeShoppingList();
  var catOrder=["legumes","viandes","laitiers","feculents","fruits","epicerie","boissons"];
  var catMap={"legumes":"legumes","viandes":"viandes","laitiers":"laitiers","feculents":"feculents","fruits":"fruits","epicerie":"epicerie","boissons":"boissons"};
  var allCats=Object.keys(grouped);
  allCats.forEach(function(cat){
    var items=grouped[cat];if(!items||!items.length) return;
    if(y>268){doc.addPage();y=20;}
    doc.setFont("helvetica","bold");doc.setFontSize(10);doc.setTextColor(26,26,46);
    doc.text(cat.charAt(0).toUpperCase()+cat.slice(1),margin,y);y+=5;
    items.forEach(function(item){y=pdfCheckItem(doc,item.name,item.qty,y,margin,pageW);});
    y+=3;
  });

  // Recipe pages
  var plannedIds={};
  Object.values(state.weekPlanning).forEach(function(id){plannedIds[id]=true;});
  Object.keys(plannedIds).forEach(function(id){
    var r=getRecipe(parseInt(id));if(!r) return;
    doc.addPage();
    var ry=pdfHeader(doc,r.title,r.tag1+" - "+r.time);
    doc.setFont("helvetica","normal");doc.setFontSize(10);doc.setTextColor(80,80,80);
    var dl=doc.splitTextToSize(r.desc,pageW-margin*2);
    doc.text(dl,margin,ry);ry+=dl.length*5+5;
    ry=pdfSectionTitle(doc,"Ingredients",ry,margin);
    r.ing.forEach(function(p){ry=pdfCheckItem(doc,p[0],p[1],ry,margin,pageW);});
    ry+=3;ry=pdfSectionTitle(doc,"Instructions",ry,margin);
    r.steps.forEach(function(s,i){
      if(ry>270){doc.addPage();ry=20;}
      doc.setFont("helvetica","bold");doc.setFontSize(10);doc.setTextColor(255,62,127);
      doc.text((i+1)+".",margin,ry);
      doc.setFont("helvetica","normal");doc.setTextColor(50,50,50);
      var sl=doc.splitTextToSize(s,pageW-margin*2-7);
      doc.text(sl,margin+7,ry);ry+=sl.length*5.5+2;
    });
  });

  doc.save("recipy-planning-complet.pdf");
  toast("PDF complet exporte !");
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OPTION B â€” Courses seules (format magasin optimise)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function exportShoppingPDF(){
  if(typeof window.jspdf==="undefined"){toast("PDF non disponible");return;}
  var jsPDF=window.jspdf.jsPDF;
  var doc=new jsPDF({orientation:"portrait",unit:"mm",format:"a4"});
  var margin=18,pageW=210;
  var y=pdfHeader(doc,"Liste de courses","Format magasin");

  var grouped=computeShoppingList();
  var catLabels={"legumes":"Legumes","viandes":"Viandes et Poissons","laitiers":"Produits laitiers","feculents":"Feculents","fruits":"Fruits","epicerie":"Epicerie","boissons":"Boissons"};
  var hasItems=false;
  var allCats=Object.keys(grouped);

  allCats.forEach(function(cat){
    var items=grouped[cat];if(!items||!items.length) return;
    hasItems=true;
    if(y>262){doc.addPage();y=20;}
    doc.setFillColor(255,240,245);
    doc.rect(margin-2,y-5,pageW-margin*2+4,8,"F");
    doc.setFont("helvetica","bold");doc.setFontSize(11);doc.setTextColor(26,26,46);
    doc.text(catLabels[cat]||cat.charAt(0).toUpperCase()+cat.slice(1),margin,y);y+=9;
    items.forEach(function(item){y=pdfCheckItem(doc,item.name,item.qty,y,margin,pageW);});
    y+=4;
  });

  if(!hasItems){
    doc.setFont("helvetica","italic");doc.setFontSize(11);doc.setTextColor(150,150,150);
    doc.text("Aucun ingredient a acheter.",margin,y);
    doc.text("Planifiez vos repas dans l'onglet Calendrier.",margin,y+7);
  }

  var mealCount=Object.keys(state.weekPlanning).length;
  doc.setFontSize(8);doc.setFont("helvetica","italic");doc.setTextColor(180,180,180);
  doc.text("Generee depuis "+mealCount+" repas - Recipy App",margin,290);

  doc.save("recipy-courses.pdf");
  toast("PDF courses exporte !");
}

})();
</script>

<script>
if('serviceWorker' in navigator){
  window.addEventListener('load', function(){
    navigator.serviceWorker.register('service-worker.js')
      .then(function(reg){ console.log('SW registered:', reg.scope); })
      .catch(function(err){ console.log('SW error:', err); });
  });
}
</script>
<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EDGE SWIPE â€” geste "retour" depuis bord gauche
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function(){
  var EDGE_ZONE    = 28;
  var MIN_DIST_X   = 60;
  var MAX_DIST_Y   = 80;
  var MAX_DURATION = 400;

  var touchStartX     = 0;
  var touchStartY     = 0;
  var touchStartTime  = 0;
  var edgeSwipeActive = false;

  document.addEventListener('touchstart', function(e){
    var t = e.touches[0];
    touchStartX    = t.clientX;
    touchStartY    = t.clientY;
    touchStartTime = Date.now();
    edgeSwipeActive = touchStartX <= EDGE_ZONE;
  }, { passive: true });

  document.addEventListener('touchend', function(e){
    if(!edgeSwipeActive) return;

    var t        = e.changedTouches[0];
    var distX    = t.clientX - touchStartX;
    var distY    = Math.abs(t.clientY - touchStartY);
    var duration = Date.now() - touchStartTime;

    if(distX >= MIN_DIST_X && distY <= MAX_DIST_Y && duration <= MAX_DURATION){
      var detail = document.getElementById('detail');
      if(detail && detail.classList.contains('active')){
        var backBtn = document.getElementById('btn-det-back');
        if(backBtn) backBtn.click();
      }
    }

    edgeSwipeActive = false;
  }, { passive: true });
})();
</script>
</body>
</html>
